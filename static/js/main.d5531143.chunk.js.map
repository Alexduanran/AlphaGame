{"version":3,"sources":["pages/Genetic.module.css","pages/Reinforcement.module.css","pages/Battle.module.css","pages/App.module.css","pages/GeneticParams.js","pages/Plot.js","games/genetic_algorithm/individual.js","games/pong/neural_network.js","games/pong/Paddle.js","games/pong/Ball.js","games/pong/settings.js","games/genetic_algorithm/population.js","games/genetic_algorithm/selection.js","games/genetic_algorithm/mutation.js","games/genetic_algorithm/crossover.js","games/pong/Pong.js","games/snake/reinforcement_learning/sprite.js","games/snake/reinforcement_learning/util.js","games/snake/genetic_algorithm/neural_network.js","games/snake/genetic_algorithm/snakeClass.js","games/snake/genetic_algorithm/settings.js","games/snake/genetic_algorithm/Snake.js","games/flappy_bird/settings.js","games/flappy_bird/neural_network.js","games/flappy_bird/assets/bluebird-midflap.png","games/flappy_bird/assets/redbird-midflap.png","games/flappy_bird/assets/yellowbird-midflap.png","games/flappy_bird/Bird.js","games/flappy_bird/Pipe.js","games/flappy_bird/Flappy.js","games/flappy_bird/assets/background-day_horizontal.png","games/flappy_bird/assets/base.png","games/flappy_bird/assets/pipe-green.png","pages/Genetic.js","media/snake.png","media/pong.png","media/flappybird.png","media/home2_gif.gif","media/snake_gif.gif","media/pong_gif.gif","media/flappybird_gif.gif","pages/Home.js","games/snake/reinforcement_learning/snakeClass.js","games/snake/reinforcement_learning/snakeGameClass.js","games/snake/reinforcement_learning/agentClass.js","games/snake/reinforcement_learning/train.js","games/snake/reinforcement_learning/config.js","games/snake/reinforcement_learning/SnakeEnv.js","pages/Reinforcement.js","pages/Battle.js","pages/App.js","reportWebVitals.js","index.js","pages/Home.module.css"],"names":["module","exports","GeneticParams","props","useState","numLayer","setNumLayer","hiddenLayerArchitecture","setHiddenLayerArchitecture","mutationRate","setMutationRate","mutationRateType","setMutationRateType","numParents","setNumParents","numOffsprings","setNumOffsprings","style","position","top","bottom","left","right","Form","Group","as","Row","Label","column","sm","color","Col","InputGroup","Prepend","Button","backgroundColor","borderColor","onClick","Array","map","value","index","FormControl","placeholder","toString","defaultValue","onChange","e","layers","Number","target","Append","OverlayTrigger","overlay","Tooltip","cursor","ButtonGroup","class","size","width","updateStart","updateSettings","Plot","data","React","useMemo","label","avgFitness","maxFitness","axes","primary","type","show","dimension","height","background","tooltip","primaryCursor","dark","Individual","nj","require","random","sigmoid","x","exp","tanh","relu","arr","i","push","linear","FeedForwardNetwork","layer_nodes","hidden_activation","output_activation","init_method","feed_forward","X","A_prev","L","length","W","b","Z","l","params","dot","add","array","tolist","out","this","inputs","Error","arrW","j","uniform","arrb","get_activation_by_name","name","activations","func","toLowerCase","console","assert","Paddle","p5","xPaddle","yPaddle","ySpeed","boardSize","chromosome","hidden_layer_architecture","fitness","calculate_fitness","hit","Math","min","distance_travelled","ball_travelled","board_size","distance_to_ball","max","reset","is_alive","update","ball","network","yBall","move","abs","draw","winner","champion","fill","rect","num_inputs","network_architecture","Ball","xBall","xSpeed","paddle","xLast","yLast","ellipse","settings","Population","individuals","num_individuals","num_individuals_","num_genes","shape","num_genes_","average_fitness","sum","average_fitness_","fittest_individual","best","indi","individual","fittest_individual_","get_fitness_std","std","a","elitism_selection","population","sort","reverse","slice","roulette_wheel_selection","selection","wheel","pick","float","current","gaussian_mutation","prob_mutation","scale","mu","sigma","mutation_array","normal","set","get","simulated_binary_crossover","parent1","parent2","eta","rand","gamma","zeros","multiply","ones","subtract","single_point_binary_crossover","offspring1","copy","offspring2","Pong","cumulativeSum","_mutation_bins","_crossover_bins","_SPBX_type","_SBX_eta","_mutation_rate","_next_gen_size","lower","format","balls","current_generation","winner_index","champion_index","champion_fitness","NEGATIVE_INFINITY","num_hit","best_hit","training_paddle","newball","next_generation","indexOf","log","addAvgFitness","addMaxFitness","shuffle","next_pop","p1","p2","c1_params","c2_params","c1_W_l","c2_W_l","c1_b_l","c2_b_l","p1_W_l","p2_W_l","p1_b_l","p2_b_l","_crossover","_mutation","c1","c2","parent1_weights","parent2_weights","parent1_bias","parent2_bias","rand_crossover","crossover_bucket","child1_weights","child2_weights","child1_bias","child2_bias","SBX","rand_mutation","mutation_bucket","mutation_rate","sqrt","temporaryValue","randomIndex","currentIndex","floor","setup","canvasParentRef","createCanvas","parent","button","createButton","mousePressed","textSize","text","bally","int","speedy","still_alive","memo","prevProps","nextProps","Rect","y","w","h","context","sprite","point","overlap","contains","Sprite","fname","PI","image","undefined","Image","src","ctx","drawImage","rotate","angle","save","dpr","translate","TO_RADIAN","restore","getRandInt","step","ceil","arrayEqual","compare","arrayContains","obj","boo","forEach","item","euclidean","x1","y1","x2","y2","random_sample","batch_size","array_copy","sample","rand_idx","splice","String","prototype","args","arguments","replace","Snake_","direction","boxSize","total_steps","apples","_fitness","steps","distance","initialize","head","body","updateDirection","reach_apple","k1","k2","tempRect","collideWall","newHead","unshift","pop","part","collideRect","extraWalls","wallRect","bool","Apple","boxLength","board_x","board_y","avoid","avoidCompare","util","rand_x","rand_y","inAvoid","Snake","num_apples","best_apples","apple","random_direction","dir","not_reach_apple","snake","new_state","test_case","oppo","state","key","test","collideWithWall","pos_cur","addHead","pos_next","pos_apple","d1","hypot","d2","collideWithBody","deleteTail","POSITIVE_INFINITY","snake_","Bird","x_pos","y_pos","y_speed","bird_top","bird_sprite","bird_bottom","bird_left","bird_right","score","x_distance_to_next_pipe_center","y_distance_to_next_pipe_center","pipes","check_collision","collide","Window_Height","champbird_sprite","winnerbird_sprite","Window_Width","loadImage","bluebird_sprite","redbird_sprite","yellowbird_sprite","Pipe","isBottom","right_x","left_x","top_or_bottom_y","top_y","bottom_y","target_sprite","target_hwidth","target_hheight","pipe_sprite","create_pipe_pair","random_pipe_pos","bottom_pipe","top_pipe","Flappy","bg_sprite","floor_sprite","floor_x","pipe_list","high_score","draw_floor","move_pipes","draw_pipes","get_next_pipe","nextnext","next_pipe","next_next_pipe","pipe","apply","bird","x_distance_to_next_next_pipe_center","y_distance_to_next_next_pipe_center","frameRate","Genetic","gameParentRef","useRef","plotParentRef","gameScreenDimension","setGameScreenDimension","plotScreenDimension","setPlotScreenDimension","setSettings","start","setStart","setAvgFitness","setMaxFitness","avgFitness_","maxFitness_","useEffect","offsetWidth","offsetHeight","basename","process","className","css","container","history","to","gameScreen","ref","path","plotScreen","href","textDecoration","Home","home2_gif","setBackground","swipeIndex","setSwipeIndex","GameSwiper","swiperContainer","effect","spaceBetween","slidesPerView","dynamicBullets","mousewheel","pagination","clickable","centeredSlides","loop","initialSlide","square","backgroundImage","snake_png","pong_png","flappybird_png","GameModes","prop","snake_gif","pong_gif","flappybird_gif","grid","smallpic","smallsquare","mode","SwiperCore","use","EffectCoverflow","Pagination","Mousewheel","screen","swiper","DIRECTION","tail","max_width","max_height","snakeGame","FPS","snakeLength","collideBody","manual","stateType","rewardType","rewardValues","eat","die","closer","away","gridSize","array2d","pix","walls","generateExtraWalls","timer","done","best_score","key_pressed","keyboard_events","last_snake","last_apple","rewardMeasures","action","update_state_12bool","tf","reward_basic","check","_direction","move_apple","clearInterval","manual_play","update_state","avoid_wall","concat","canvas","clearRect","snakeSprite","wallSprite","appleSprite","self","setInterval","tempTail","changeDirection","end_game","addTail","conclude_step","last_distance","next_state","reward","clear_reward","document","addEventListener","event","Deque","maxlen","shift","Agent","state_size","action_size","epsilon","epsilon_decay","epsilon_min","learning_rate","model","build_model","memory","dense","units","inputShape","activation","compile","optimizer","adam","learningRate","loss","pushDeque","exploit","Promise","resolve","reject","predict","reshape","pred","argMax","mini_batch","future_value","dataSync","target_state","then","fit","performanceArray","train","env","agent","n_episodes","max_moves","last_episode","exp_replay","cum_reward","act","remember","replay","processLog","EXTRA_WALL","row","col","SnakeEnv","screen_width","screen_height","adaptive_grid_size","screen_size","text_size","round","button_radius","button_x","button_y","env_params","doManual","game","doTest","id","doTrain","stroke","mouseClicked","mouseX","mouseY","Reinforcement","Battle","createBrowserHistory","App","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","getElementById"],"mappings":"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","file":"static/js/main.d5531143.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"background\":\"Genetic_background__zkABP\",\"container\":\"Genetic_container__3BPBj\",\"gameScreen\":\"Genetic_gameScreen__3qtyt\",\"name\":\"Genetic_name__vF0vp\",\"text\":\"Genetic_text__1bC0W\",\"plotScreen\":\"Genetic_plotScreen__3dRxY\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"background\":\"Reinforcement_background__1Bv23\",\"container\":\"Reinforcement_container__3LXxV\",\"gameScreen\":\"Reinforcement_gameScreen__1ndi4\",\"name\":\"Reinforcement_name__TAEiF\",\"text\":\"Reinforcement_text__9Aprn\",\"plotScreen\":\"Reinforcement_plotScreen__3DOwi\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"background\":\"Battle_background__2bwgt\",\"container\":\"Battle_container__3Hpn_\",\"gameScreen\":\"Battle_gameScreen__1hthJ\",\"name\":\"Battle_name__EcAiI\",\"text\":\"Battle_text__34_Jy\",\"plotScreen\":\"Battle_plotScreen__6ZSH0\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"background\":\"App_background__3GJc-\"};","import React, { useState } from 'react';\nimport { Form, FormControl, InputGroup, Button, ButtonGroup, Tooltip, OverlayTrigger, Row, Col } from 'react-bootstrap';\n\nfunction GeneticParams(props) {\n    const [numLayer, setNumLayer] = useState(2);\n    const [hiddenLayerArchitecture, setHiddenLayerArchitecture] = useState([12, 6]);\n    const [mutationRate, setMutationRate] = useState(0.05);\n    const [mutationRateType, setMutationRateType] = useState('static');\n    const [numParents, setNumParents] = useState(50);\n    const [numOffsprings, setNumOffsprings] = useState(100);\n\n    return (\n        <div style={{position:'absolute', top:'2.5%', bottom:'0px', left:'0px', right:'0px'}}>\n            <Form>\n                <Form.Group as={Row}>\n                    <Form.Label column sm='5' style={{color:'white', left:'4%'}}>\n                        Hidden Layer Architecture\n                    </Form.Label>\n                    <Col style={{right:'4%'}}>\n                        <InputGroup>\n                            <InputGroup.Prepend>\n                                <Button style={{backgroundColor:'blueviolet', borderColor:'blueviolet'}} onClick={()=>setNumLayer(numLayer == 1 ? 1 : numLayer-1)}>\n                                    -\n                                </Button>\n                                <Button style={{backgroundColor:'blueviolet', borderColor:'blueviolet'}} onClick={()=>setNumLayer(numLayer == 3 ? 3 : numLayer+1)}>\n                                    +\n                                </Button>\n                            </InputGroup.Prepend>\n                            {\n                                [...Array(numLayer)].map((value, index) => {\n                                    return <FormControl placeholder={'layer'+(index+1).toString()} key={index} defaultValue={hiddenLayerArchitecture[index]}\n                                            // style={{width}}\n                                            onChange={e => {\n                                                var layers = hiddenLayerArchitecture;\n                                                layers[index] = Number(e.target.value);\n                                                setHiddenLayerArchitecture(layers);\n                                            }}/>\n                                })\n                            }\n                            <InputGroup.Append>\n                                <OverlayTrigger overlay={<Tooltip>Enter the number of nodes in each layer</Tooltip>}>\n                                    <Button style={{backgroundColor:'blueviolet', borderColor:'blueviolet', cursor:'default'}}>\n                                        &#9432;\n                                    </Button>\n                                </OverlayTrigger>\n                            </InputGroup.Append>\n                        </InputGroup>               \n                    </Col>\n                </Form.Group>\n                <Form.Group as={Row}>\n                    <Form.Label column sm='5' style={{color:'white', left:'4%'}}>\n                        Mutation Rate\n                    </Form.Label>\n                    <Col style={{right:'4%'}}>\n                        <InputGroup>\n                            <FormControl defaultValue={mutationRate} onChange={e => setMutationRate(Number(e.target.value))}/>\n                            <InputGroup.Append>\n                                <OverlayTrigger overlay={<Tooltip>Enter the number of nodes in each layer</Tooltip>}>\n                                    <Button style={{backgroundColor:'blueviolet', borderColor:'blueviolet', cursor:'default'}}>\n                                        &#9432;\n                                    </Button>\n                                </OverlayTrigger>\n                            </InputGroup.Append>\n                        </InputGroup>\n                    </Col>\n                </Form.Group>\n                <Form.Group as={Row}>\n                    <Form.Label column sm='5' style={{color:'white', left:'4%'}}>\n                        Mutation Rate Type\n                    </Form.Label>\n                    <Col style={{right:'4%'}}>\n                        <ButtonGroup>\n                            <Button style={{backgroundColor:mutationRateType==='static' ? '#6918b4' : 'blueviolet', borderColor:'blueviolet'}} onClick={()=>setMutationRateType('static')}>Static</Button>\n                            <Button style={{backgroundColor:mutationRateType==='decay' ? '#6918b4' : 'blueviolet', borderColor:'blueviolet'}} onClick={()=>setMutationRateType('decay')}>Decay</Button>\n                        </ButtonGroup>\n                    </Col>\n                    <Col style={{left:'13.2%'}}>\n                        <OverlayTrigger overlay={<Tooltip >\n                                                    Static: Mutation rate stays the same throughout generations <br />\n                                                    Decay: Mutation rate decreases as generation increasesr\n                                                </Tooltip>}>\n                            <Button style={{backgroundColor:'blueviolet', borderColor:'blueviolet', cursor:'default'}}>\n                                &#9432;\n                            </Button>\n                        </OverlayTrigger>\n                    </Col>\n                </Form.Group>\n                <Form.Group as={Row}>\n                    <Form.Label column sm='5' style={{color:'white', left:'4%'}}>\n                        Number of Parents\n                    </Form.Label>\n                    <Col style={{right:'4%'}}>\n                        <InputGroup>\n                            <FormControl defaultValue={numParents} onChange={e => setNumParents(Number(e.target.value))}/>\n                            <InputGroup.Append>\n                                <OverlayTrigger overlay={<Tooltip>Enter the number of parents to generate offsprings</Tooltip>}>\n                                    <Button style={{backgroundColor:'blueviolet', borderColor:'blueviolet', cursor:'default'}}>\n                                        &#9432;\n                                    </Button>\n                                </OverlayTrigger>\n                            </InputGroup.Append>\n                        </InputGroup>\n                    </Col>\n                </Form.Group>\n                <Form.Group as={Row}>\n                    <Form.Label column sm='5' style={{color:'white', left:'4%'}}>\n                        Number of Offsprings\n                    </Form.Label>\n                    <Col style={{right:'4%'}}>\n                        <InputGroup>\n                            <FormControl defaultValue={numOffsprings} onChange={e => setNumOffsprings(Number(e.target.value))}/>\n                            <InputGroup.Append>\n                                <OverlayTrigger overlay={<Tooltip>Enter the number of offsprings to be generated by parents</Tooltip>}>\n                                    <Button style={{backgroundColor:'blueviolet', borderColor:'blueviolet', cursor:'default'}}>\n                                        &#9432;\n                                    </Button>\n                                </OverlayTrigger>\n                            </InputGroup.Append>\n                        </InputGroup>\n                    </Col>\n                </Form.Group>\n                <div class='text-center'>\n                    <Button size='lg' \n                            style={{width:'30%', backgroundColor:'blueviolet', borderColor:'blueviolet'}}\n                            onClick={()=>{\n                                        props.updateStart();\n                                        props.updateSettings(hiddenLayerArchitecture,mutationRate,mutationRateType,numParents,numOffsprings);\n                                    }}>\n                        Start \n                    </Button>\n                </div>\n            </Form>\n        </div>\n    )\n}\n\nexport default GeneticParams;","import React, { useState, useEffect } from 'react';\nimport { Chart } from 'react-charts';\n\nfunction Plot(props) {\n\n    const data = React.useMemo(\n        () => [\n            {\n                label: 'Average Fitness',\n                data: props.avgFitness\n            },\n            {\n                label: 'Max Fitness',\n                data: props.maxFitness\n            }\n        ],\n        [props.avgFitness, props.maxFitness]\n    )\n\n    const axes = React.useMemo(\n        () => [\n            { primary:true, type:'linear', position:'bottom', show:props.avgFitness},\n            { type:'linear', position: 'left', show:props.maxFitness},\n        ],\n        [props.avgFitness, props.maxFitness]\n    )\n\n    return (\n        <div\n            style ={{\n                width: props.dimension[0],\n                height: props.dimension[1],\n                background: 'black'\n            }}\n        >\n            <Chart data={data} axes={axes} tooltip primaryCursor dark/>\n        </div>\n    )\n}\n\nexport default Plot;","function Individual() {\n    const calculate = () => {\n        throw new Error('calculate_fitness function must be defined');\n    }\n\n    const fitness = () => {\n        throw new Error('fitness property must be defined');\n    }\n\n    const fitness_ = () => {\n        throw new Error('fitness property cannot be set. Use calculate_fitness instead');\n    }\n\n    const encode_chromosome = () => {\n        throw new Error('encode_chromosome function must be defined');\n    }\n\n    const decode_chromosome = () => {\n        throw new Error('decode_chromosome function must be defined');\n    }\n\n    const chromosome = () => {\n        throw new Error('chromosome property must be defined');\n    }\n\n    const chromosome_ = (val) => {\n        throw new Error('chromosome property cannot be set.');\n    }\n}\n\nexport default Individual;","var nj = require('@aas395/numjs');\nconst random = require('random');\n\nexport const sigmoid = x => {return 1.0 / (1.0 + nj.exp(-x))};\nexport const tanh = x => {return nj.tanh(x)};\nexport const relu = x => {\n    var arr = [];\n    for (var i of x) {\n        if (i >= 0)\n            arr.push(i);\n        else\n            arr.push([0]);\n    }\n    return arr;\n};\nexport const linear = x => x;\n\nexport class FeedForwardNetwork {\n    constructor(layer_nodes, hidden_activation, output_activation, init_method='uniform', seed=null) {\n        this.params = {};\n        this.layer_nodes = layer_nodes;\n        this.hidden_activation = hidden_activation;\n        this.output_activation = output_activation;\n        this.inputs = null;\n        this.out = null;\n\n        // Initialize weights and bias\n        for (var l=1; l < this.layer_nodes.length; l++) {\n            if (init_method == 'uniform') {\n                var arrW = []\n                for (var i=0; i < this.layer_nodes[l]; i++) {\n                    var arr = []\n                    for (var j=0; j < this.layer_nodes[l-1]; j++) {\n                        arr.push(random.uniform(-1,1)());\n                    }\n                    arrW.push(arr);\n                }\n                var arrb = [];\n                for (var i=0; i < this.layer_nodes[l]; i++) {\n                    arrb.push([random.uniform(-1,1)()]);\n                }\n                this.params['W' + l.toString()] = arrW;\n                this.params['b' + l.toString()] = arrb;\n            } else {\n                throw new Error('Implement more options, bro');\n            }\n            \n            this.params['A' + l.toString()] = null;\n        }\n    }\n\n    feed_forward = (X) => {\n        var A_prev = X;\n        const L = this.layer_nodes.length - 1;\n        var W = null;\n        var b = null;\n        var Z = null;\n        // Feed hidden layers\n        for (var l=1; l<L; l++) {\n            W = this.params['W' + l.toString()];\n            b = this.params['b' + l.toString()];\n            // console.log(W, A_prev);\n            // console.log('dot', typeof nj.dot(W,A_prev), nj.dot(W, A_prev))\n            // console.log('b', typeof nj.array(b), nj.array(b))\n            Z = nj.dot(W, A_prev).add(nj.array(b));\n            // console.log('Z', typeof Z, Z)\n            A_prev = this.hidden_activation(Z.tolist());\n            // console.log('A_prev', A_prev)\n            this.params['A' + l.toString()] = A_prev;\n        }\n\n        W = this.params['W' + L.toString()];\n        b = this.params['b' + L.toString()];\n        Z = nj.dot(W, A_prev).add(nj.array(b));\n        const out = this.hidden_activation(Z.tolist());\n        this.params['A'+L.toString()] = out;\n        for (var i=0; i<out.length; i++) {\n            if (this.out === null)\n                this.out = i;\n            else {\n                if (out[i][0] > this.out)\n                    this.out = i\n            }\n        }\n        // console.log('a', out)\n        // console.log('out', this.out)\n        return this.out;\n    }\n}\n\nexport const get_activation_by_name = name => {\n    const activations = [['relu', relu],\n                        ['sigmoid', sigmoid],\n                        ['linear', linear],\n                        ['tanh', tanh]\n                        ]\n    var func = [];\n    for (var i=0; i<activations.length; i++) {\n        if (activations[i][0] === name.toLowerCase())\n            func.push(activations[i][1]);\n    }\n    console.assert(func.length == 1);\n    return func[0];\n}","import Individual from '../genetic_algorithm/individual';\nimport {FeedForwardNetwork, linear, sigmoid, tanh, relu, get_activation_by_name} from './neural_network';\n\n// var nj = require('numjs');\n\nclass Paddle extends Individual{\n    constructor(p5, xPaddle=0, yPaddle=200, ySpeed=0, boardSize, chromosome=null, hidden_layer_architecture=[20,12], hidden_activation='relu', output_activation='sigmoid') {\n        super(Individual());\n        this.xPaddle = xPaddle;\n        this.yPaddle = yPaddle;\n        this.ySpeed = ySpeed;\n        this.board_size = boardSize;\n\n        this.fitness = 0;\n        this.hit = 0;\n        this.distance_travelled = 0;\n        this.ball_travelled = 0;\n        this.distance_to_ball = 0;\n        this.is_alive = true;\n\n        this.hidden_layer_architecture = hidden_layer_architecture;\n        this.hidden_activation = hidden_activation;\n        this.output_activation = output_activation;\n\n        // Setting up network architecture\n        // Each \"Vision\" has 3 distances it tracks: wall, apple and self\n        // there are also one-hot encoded direction and one-hot encoded tail direction,\n        // each of which have 4 possibilities.\n        const num_inputs = 5  \n        this.network_architecture = [num_inputs]                          // Inputs\n        this.network_architecture.push(...this.hidden_layer_architecture)  // Hidden layers\n        this.network_architecture.push(3)                               // 3 outputs, ['left', 'still', 'right']\n        this.network = new FeedForwardNetwork(this.network_architecture,\n                                          get_activation_by_name(this.hidden_activation),\n                                          get_activation_by_name(this.output_activation)\n        )\n\n        // If chromosome is set, take it\n        if (chromosome) {\n            // this._chromosome = chromosome\n            this.network.params = chromosome\n            // this.decode_chromosome()\n        } else {\n            // this._chromosome = {}\n            // this.encode_chromosome()\n        }\n        \n    }\n\n    fitness = () => {\n        return this.fitness;\n    }\n\n    calculate_fitness = () => {\n        this.fitness = (2 ** this.hit + this.hit * 2.1) * 200 + ((1 - Math.min(this.distance_travelled / this.ball_travelled, 1)) * 400) + (this.board_size[0] - this.distance_to_ball) * 0.5;\n        this.fitness = Math.max(this.fitness, .1);\n    }\n\n    reset = () => {\n        this.fitness = 0;\n        this.hit = 0;\n        this.distance_travelled = 0;\n        this.distance_to_ball = 0;\n        this.is_alive = 0;\n    }\n\n    update = (inputs=null, ball=null) => {\n        if (inputs !== null) {\n            this.network.feed_forward(inputs);\n        } else if (ball !== null) {\n            this.yPaddle = ball.yBall - 45;\n        }\n        if (this.network.out === 0) {\n            this.ySpeed = -15;\n        } else if (this.network.out === 1) {\n            this.ySpeed = 15;\n        } else if (this.network.out === 2) {\n            this.ySpeed = 0;\n        }\n        return true;\n    }\n\n    move = () => {\n        this.yPaddle += this.ySpeed;\n        this.distance_travelled += Math.abs(this.ySpeed);\n    }\n\n    draw = (p5, winner=false, champion=false) => {\n        if (!this.is_alive) {\n            return;\n        } else if (champion) {\n            p5.fill('#FFD700');\n            p5.rect(this.xPaddle, this.yPaddle, 15, 90);\n        } else if (winner) {\n            p5.fill('#00FFFF');\n            p5.rect(this.xPaddle, this.yPaddle, 15, 90);\n        } else {\n            p5.fill('#FFFFFF');\n            p5.rect(this.xPaddle, this.yPaddle, 15, 90);\n        }\n    }\n}\n\nexport default Paddle;","class Ball {\n    constructor(xBall, yBall, xSpeed, ySpeed) {\n        this.xBall = xBall;\n        this.yBall = yBall;\n        this.xSpeed = xSpeed;\n        this.ySpeed = ySpeed;\n        this.xLast = xBall - xSpeed;\n        this.yLast = yBall - ySpeed;\n\n        this.is_alive = true;\n        this.distance_travelled = 0;\n    }\n    \n\n    update = (paddle, boardSize) => {\n        this.distance_travelled += Math.abs(this.ySpeed);\n\n        if (this.yBall < 0) {\n            this.yBall = 0;\n            this.ySpeed *= -1;\n        }\n        else if (this.yBall > boardSize[1]-20) {\n            this.yBall = boardSize[1]-20;\n            this.ySpeed *= -1;\n        }\n        else if (this.xBall > boardSize[0]-35) {\n            this.xBall = boardSize[0]-35;\n            this.xSpeed *= -1;\n        }\n        else if (this.yBall > paddle.yPaddle-10 && this.yBall < paddle.yPaddle + 80 && this.xLast > 15 && this.xBall <= 15) {\n            this.xSpeed *= -1;\n            paddle.hit += 1;\n            paddle.distance_to_ball = 0;\n        }\n        else if (this.xBall < 0) {\n            this.xSpeed *= -1;\n            paddle.ball_travelled = this.distance_travelled;\n            paddle.is_alive = false;\n            paddle.distance_to_ball = Math.abs(this.xBall - paddle.xPaddle);\n        }\n    }\n\n    move = () => {\n        this.xLast = this.xBall;\n        this.yLast = this.yBall;\n\n        this.xBall += this.xSpeed;\n        this.yBall += this.ySpeed;\n    }\n\n    draw = (p5) => {\n        p5.fill('#FFFFFF');\n        p5.ellipse(this.xBall, this.yBall, 20, 20);\n    }\n}\n\nexport default Ball;","const settings = {\n    // Hidden layer activation is specific to hidden layers, i.e. all layers except the input and output\n    'hidden_layer_activation':     'relu',     // Options are [relu, sigmoid, tanh, linear, leaky_relu]\n    // Output layer activation is specific to the output layer \n    'output_layer_activation':     'sigmoid',  // Options are [relu, sigmoid, tanh, linear, leaky_relu]\n    // Hidden network architecture describes the number of nodes in each hidden layer\n    'hidden_network_architecture': [12, 20, 12],   // A list containing number of nodes in each hidden layer\n\n    //### GA stuff ####\n\n    //# Mutation ##\n\n    // Mutation rate is the probability that a given gene in a chromosome will randomly mutate\n    'mutation_rate':               0.05,       // Value must be between [0.00, 1.00)\n    // If the mutation rate type is static, then the mutation rate will always be `mutation_rate`,\n    // otherwise if it is decaying it will decrease as the number of generations increase\n    'mutation_rate_type':          'static',   // Options are [static, decaying]\n    // The probability that if a mutation occurs, it is gaussian\n    'probability_gaussian':        1.0,        // Values must be between [0.00, 1.00]\n    // The probability that if a mutation occurs, it is random uniform\n    'probability_random_uniform':  0.0,        // Values must be between [0.00, 1.00]\n\n    //# Crossover ##\n    \n    // eta related to SBX. Larger values create a distribution closer around the parents while smaller values venture further from them.\n    // Only used if probability_SBX > 0.00\n    'SBX_eta':                     100,\n    // Probability that when crossover occurs, it is simulated binary crossover\n    'probability_SBX':             1,\n    // The type of SPBX to consider. If it is 'r' then it flattens a 2D array in row major ordering.\n    // If SPBX_type is 'c' then it flattens a 2D array in column major ordering.\n    'SPBX_type':                   'r',        // Options are 'r' for row or 'c' for column\n    // Probability that when crossover occurs, it is single point binary crossover\n    'probability_SPBX':            0,\n    // Crossover selection type determines the way in which we select individuals for crossover\n    'crossover_selection_type':    'roulette_wheel',\n\n    //# Selection ##\n\n    // Number of parents that will be used for reproducing\n    'num_parents':                 50,\n    // Number of offspring that will be created. Keep num_offspring >= num_parents\n    'num_offspring':               100,\n    // The selection type to use for the next generation.\n    // If selection_type == 'plus':\n    //     Then the top num_parents will be chosen from (num_offspring + num_parents)\n    // If selection_type == 'comma':\n    //     Then the top num_parents will be chosen from (num_offspring)\n    // @NOTE: if the lifespan of the individual is 1, then it cannot be selected for the next generation\n    // If enough indivduals are unable to be selected for the next generation, new random ones will take their place.\n    // @NOTE: If selection_type == 'comma' then lifespan is ignored.\n    //   This is equivalent to lifespan = 1 in this case since the parents never make it to the new generation.\n    'selection_type':              'plus',     // Options are ['plus', 'comma']\n}\n\nexport default settings;","var nj = require('@aas395/numjs');\n\nclass Population {\n    constructor(individuals) {\n        this.individuals = individuals;\n    }\n\n    num_individuals = () => {\n        return this.individuals.length;\n    }\n\n    num_individuals_ = () => {\n        throw new Error('Cannot set the number of individuals. You must change Population.individuals instead');\n    }\n\n    num_genes = () => {\n        return this.individuals[0].chromosome.shape[1];\n    }\n\n    num_genes_ = () => {\n        throw new Error('Cannot set the number of genes. You must change Population.individuals instead');\n    }\n\n    average_fitness = () => {\n        var sum = 0;\n        for (var individual of this.individuals)\n            sum += individual.fitness;\n        return sum / this.individuals.length;\n    }\n\n    average_fitness_ = () => {\n        throw new Error('Cannot set average fitness. This is a read-only property.');\n    }\n\n    fittest_individual = () => {\n        var best = 0;\n        var indi = null;\n        for (var individual of this.individuals) {\n            if (individual.fitness > best) {\n                best = individual.fitness;\n                indi = individual;\n            }\n        }\n        return indi;\n    }\n\n    fittest_individual_ = () => {\n        throw new Error('Cannot set fittest individual. This is a read-only property');\n    }\n\n    calculate_fitness = () => {\n        for (var individual of this.individuals) {\n            individual.calculate_fitness();\n        }\n    }\n\n    get_fitness_std = () => {\n        return nj.std(nj.array(this.individuals.map(a=>a.fitness)));\n    }\n}\n\nexport default Population;","var nj = require('@aas395/numjs');\nconst random = require('random');\n\nexport function elitism_selection(population, num_individuals) {\n    var individuals = population.individuals.sort(a=>a.fitness).reverse();\n    return individuals.slice(0, num_individuals);\n}\n\nexport function roulette_wheel_selection(population, num_individuals) {\n    var selection = [];\n    var wheel = 0;\n    for (var individual of population.individuals) {\n        wheel += individual.fitness;\n    }\n    for (var i=0; i<num_individuals; i++) {\n        const pick = random.float(0, wheel);\n        var current = 0;\n        for (var individual of population.individuals) {\n            current += individual.fitness;\n            if (current > pick) {\n                selection.push(individual);\n                break;\n            }\n        }\n    }\n    return selection;\n}","var nj = require('@aas395/numjs');\nvar random = require('random');\n\nexport function gaussian_mutation(chromosome, prob_mutation, scale=null, mu=null, sigma=null) {\n    /*\n    Perform a gaussian mutation for each gene in an individual with probability, prob_mutation.\n\n    If mu and sigma are defined then the gaussian distribution will be drawn from that,\n    otherwise it will be drawn from N(0, 1) for the shape of the individual.\n    */\n   // Determine which genes will be mutated\n   var mutation_array = [];\n   for (var i=0; i<chromosome.shape[0]; i++) {\n        var arr = [];\n        for (var j=0; j<chromosome.shape[1]; j++) \n            arr.push(random.float() < prob_mutation ? 1 : 0);\n        mutation_array.push(arr);\n   }\n   // If mu and sigma are defined, create gaussian distribution around each one\n   var gaussian_mutation = [];\n   if (mu && sigma) {\n       gaussian_mutation = random.normal(mu, sigma)();\n   } else {\n        for (var i=0; i<chromosome.shape[0]; i++) {\n            var arr = [];\n            for (var j=0; j<chromosome.shape[1]; j++) \n                arr.push(random.normal()());\n            gaussian_mutation.push(arr);\n        }\n   }\n\n   if (scale) {\n       for (var i = 0; i<chromosome.shape[0]; i++) {\n            for (var j=0; j<chromosome.shape[1]; j++) {\n                if (mutation_array[i][j])\n                    gaussian_mutation[i][j] *= scale;\n            }\n       }\n   }\n   // Update\n   for (var i = 0; i<chromosome.shape[0]; i++) {\n        for (var j=0; j<chromosome.shape[1]; j++) {\n            if (mutation_array[i][j] === 1)\n                chromosome.set(i, j, chromosome.get(i,j) + gaussian_mutation[i][j]);\n        }\n    } \n}\n\nexport function random_uniform_mutation(chromosome, prob_mutation, low, high) {\n    // var mutation_array = nj.random.random(chromosome.shape) < prob_mutation;\n    // if (low isinstanceof Array) {\n\n    // }\n}","var nj = require('@aas395/numjs');\nconst random = require('random');\n\nexport function simulated_binary_crossover(parent1, parent2, eta) {\n    /*\n    This crossover is specific to floating-point representation.\n    Simulate behavior of one-point crossover for binary representations.\n\n    For large values of eta there is a higher probability that offspring will be created near the parents.\n    For small values of eta, offspring will be more distant from parents\n    */\n    var rand = nj.random(nj.array(parent1).shape);\n    var gamma = nj.zeros(nj.array(parent1).shape);\n    for (var i=0; i<gamma.shape[0]; i++) {\n        for (var j=0; j<gamma.shape[1]; j++) {\n            if (rand.get(i,j) <= 0.5) {\n                gamma.set(i, j, ((2 * rand.get(i,j)) ** (1.0 / (eta + 1))));\n            }\n            else {\n                gamma.set(i, j, ((1.0 / (2.0 * (1.0 - rand.get(i,j)))) ** (1.0 / (eta + 1))));\n            }\n        }\n    }\n    // Calculate Child 1 chromosome (Eq. 9.9)\n    var chromosome1 = (((gamma.add(1)).multiply(parent1)).add(nj.ones(gamma.shape).subtract(gamma)).multiply(parent2)).multiply(0.5);\n    // Calculate Child 2 chromosome (Eq. 9.10)\n    var chromosome2 = (((nj.ones(gamma.shape).subtract(gamma)).multiply(parent1)).add((gamma.add(1)).multiply(parent2)).multiply(0.5));\n\n    return [chromosome1, chromosome2];\n}\n\nexport function uniform_binary_crossover(parent1, parent2) {\n    var offspring1 = nj.copy(parent1);\n    var offspring2 = nj.copy(parent2);\n\n    var mask = [];\n    for (var i=0; i<offspring1.shape; i++)\n        mask.push(random.uniform(0, 1));\n    offspring1[mask > 0.5] = parent2[mask > 0.5];\n    offspring2[mask > 0.5] = parent1[mask > 0.5];\n\n    return [offspring1, offspring2];\n}\n\nexport function single_point_binary_crossover(parent1, parent2, major='r') {\n    var offspring1 = nj.copy(parent1);\n    var offspring2 = nj.copy(parent2);\n\n    // var rows, cols = parent2.shape;\n    // const row = random.int(0, rows);\n    // const col = random.int(0, cols);\n\n    // if (major.toLowerCase() === 'r') {\n    //     off\n    // }\n    return [offspring1, offspring2];\n}","import React from 'react';\nimport Sketch from 'react-p5';\nimport Paddle from './Paddle';\nimport Ball from './Ball';\nimport settings from './settings';\nimport Population from '../genetic_algorithm/population';\nimport {FeedForwardNetwork, sigmoid, linear, relu} from './neural_network'\nimport {elitism_selection, roulette_wheel_selection} from '../genetic_algorithm/selection';\nimport {gaussian_mutation, random_uniform_mutation} from '../genetic_algorithm/mutation';\nimport {simulated_binary_crossover as SBX} from '../genetic_algorithm/crossover';\nimport {uniform_binary_crossover, single_point_binary_crossover} from '../genetic_algorithm/crossover';\nconst random = require('random');\nvar nj = require('@aas395/numjs');\n\nfunction Pong(props) {\n    const cumulativeSum = (sum => value => sum += value)(0);\n    var _mutation_bins = [settings['probability_gaussian'], settings['probability_random_uniform']].map(cumulativeSum);\n    var _crossover_bins = [settings['probability_SBX'], settings['probability_SPBX']].map(cumulativeSum);\n    var _SPBX_type = settings['SPBX_type'].toLowerCase();\n    var _SBX_eta = settings['SBX_eta'];\n    var _mutation_rate = props.settings['mutationRate'];\n\n    // Determine size of next gen based off selection type\n    var _next_gen_size = null;\n    if (settings['selection_type'].toLowerCase() == 'plus')\n        _next_gen_size = props.settings['numParents'] + props.settings['numOffsprings'];\n    else if (settings['selection_type'].lower() == 'comma')\n        _next_gen_size = props.settings['numOffsprings'];\n    else\n        throw new Error('Selection type \"{}\" is invalid'.format(settings['selectionType']));\n\n    var board_size = props.dimension;\n\n    var individuals = [];\n    var balls = [];\n\n    var population = new Population(individuals);\n    var current_generation = 0;\n    var winner = null;\n    var winner_index = -1;\n    var champion = null;\n    var champion_index = -1;\n    var champion_fitness = Number.NEGATIVE_INFINITY;\n\n    var num_hit = 0;\n    var best_hit = 0;\n\n    var training_paddle = null;\n    var newball = true;\n\n    const setup = (p5, canvasParentRef) => {\n        // use parent to render the canvas in this ref\n        // (without that p5 will render the canvas outside of your component)\n        p5.createCanvas(board_size[0], board_size[1]).parent(canvasParentRef);\n        training_paddle = new Paddle(p5, board_size[0]-15, board_size[1]/2-45, 0, board_size);\n        for (var i=0; i < props.settings['numParents']; i++) {\n            const individual = new Paddle(p5, 0, board_size[1]/2-45, 0, board_size, null,\n                                    props.settings['hiddenLayerArchitecture'], \n                                    settings['hidden_layer_activation', \n                                    settings['output_activation']]);\n            individuals.push(individual);\n        }\n        const button = p5.createButton('Return').parent(canvasParentRef);\n        button.position(30, 10);\n        button.style('background-color', '#8A2BE2')\n        button.mousePressed(props.updateStart);\n    };\n \n    const draw = (p5) => {\n        p5.background(0);\n        p5.textSize(20);\n        p5.fill('#FFFFFF');\n        p5.text('Generation: '+current_generation, board_size[0]-180, 30);\n        p5.text('Hit: '+num_hit, board_size[0]-180, 60);\n        p5.text('Best: '+best_hit, board_size[0]-180, 90);\n        // New set of balls\n        if (newball) {\n            balls = [];\n            const bally = random.int(0, board_size[1]);\n            const speedy = random.int() === 1 ? 15 : -15;\n            for (var i=0; i < _next_gen_size+1; i++) {\n                balls.push(new Ball(board_size[0] / 2, bally, 15, speedy));\n            }\n            newball = false;\n        }\n\n        // Update training paddle\n        training_paddle.update(null, balls[balls.length-1]);\n        balls[balls.length-1].update(training_paddle, board_size);\n        balls[balls.length-1].move();\n        training_paddle.is_alive = true;\n        training_paddle.draw(p5);\n\n        var still_alive = 0;\n        // Loop through the paddles in the generation\n        for (var i=0; i < population.individuals.length; i++) {\n            var paddle = population.individuals[i];\n\n            if (paddle.is_alive) {\n                still_alive++;\n                //----------------------------------------inputs for neural network--------------------------------------------\n                // const distance = ((balls[i].y - paddle.y_pos) ** 2 + (balls[i].x - paddle.x_pos) ** 2) ** 0.5;\n                // const ball_distance_left_wall = balls[i].yBall - 0;\n                // const ball_distance_right_wall = board_size[1] - balls[i].yBall;\n                const inputs = [[paddle.yPaddle], [balls[i].ySpeed], [paddle.ySpeed], [balls[i].yBall], [balls[i].xSpeed]];\n                // inputs = np.array([[paddle.x_pos], [balls[i].xspeed], [paddle.xspeed], [balls[i].x]])\n                //----------------------------------------inputs for neural network--------------------------------------------\n                paddle.update(inputs);\n                balls[i].update(paddle, board_size);\n                num_hit = Math.max(num_hit, paddle.hit);\n                best_hit = Math.max(num_hit, best_hit);\n                balls[i].move();\n                paddle.move();\n            }\n\n            // Draw every paddle except the best ones\n            if (paddle.is_alive && paddle !== winner && paddle !== champion) {\n                // paddle.winner = False\n                // paddle.champion = False\n                balls[i].draw(p5);\n                paddle.draw(p5);\n            }\n        }\n\n        // Draw the winning and champion paddle last\n        if (winner !== null && winner.is_alive) {\n            balls[winner_index].draw(p5);\n            winner.draw(p5, true, false);\n        }\n        if (champion !== null && champion.is_alive) {\n            balls[champion_index].draw(p5);\n            champion.draw(p5, false, true);\n        }\n\n        // Generate new generation when all have died out\n        if (still_alive === 0)\n            next_generation(p5);\n    };\n\n    const next_generation = (p5) => {\n        current_generation++;\n        newball = true;\n        num_hit = 0;\n        \n        // Calculate fitness of individuals\n        for (var individual of population.individuals)\n            individual.calculate_fitness();\n        \n        // Find winner from each generation and champion\n        winner = population.fittest_individual();\n        winner_index = population.individuals.indexOf(winner);\n        if (winner.fitness > champion_fitness) {\n            champion_fitness = winner.fitness;\n            champion = winner;\n            champion_index = winner_index;\n        }\n        winner.reset();\n        champion.reset();\n\n        // Print results from each generation\n        console.log('======================= Generation', current_generation, '=======================');\n        console.log('----Max fitness:', population.fittest_individual().fitness);\n        // print('----Best Score:', self.population.fittest_individual.score);\n        console.log('----Average fitness:', population.average_fitness());\n\n        props.addAvgFitness(population.average_fitness());\n        props.addMaxFitness(population.fittest_individual().fitness);\n        \n        population.individuals = elitism_selection(population, props.settings['numParents']);\n        population.individuals = shuffle(population.individuals);\n        var next_pop = [];\n\n        // parents + offspring selection type ('plus')\n        if (settings['selection_type'].toLowerCase() === 'plus') {\n            next_pop.push(winner);\n            next_pop.push(champion);\n        }\n\n        while (next_pop.length < _next_gen_size) {\n            var [p1, p2] = roulette_wheel_selection(population, 2);\n            const L = p1.network.layer_nodes.length;\n            var c1_params = {};\n            var c2_params = {};\n\n            // Each W_l and b_l are treated as their own chromosome.\n            // Because of this I need to perform crossover/mutation on each chromosome between parents\n            for (var l = 1; l < L; l++) {\n                const p1_W_l = p1.network.params['W' + l.toString()]\n                const p2_W_l = p2.network.params['W' + l.toString()]\n                const p1_b_l = p1.network.params['b' + l.toString()]\n                const p2_b_l = p2.network.params['b' + l.toString()]\n\n                var c1_W_l = null, c2_W_l = null, c1_b_l = null, c2_b_l = null;\n\n                // Crossover\n                // @NOTE: I am choosing to perform the same type of crossover on the weights and the bias.\n                [c1_W_l, c2_W_l, c1_b_l, c2_b_l] = _crossover(p1_W_l, p2_W_l, p1_b_l, p2_b_l);\n\n                // Mutation\n                // @NOTE: I am choosing to perform the same type of mutation on the weights and the bias.\n                _mutation(c1_W_l, c2_W_l, c1_b_l, c2_b_l);\n\n                // Assign children from crossover/mutation\n                c1_params['W' + l.toString()] = c1_W_l;\n                c2_params['W' + l.toString()] = c2_W_l;\n                c1_params['b' + l.toString()] = c1_b_l;\n                c2_params['b' + l.toString()] = c2_b_l;\n\n                // Clip to [-1, 1]\n                for (var i=0; i<c1_params['W'+l.toString()].shape[0]; i++) {\n                    for (var j=0; j<c1_params['W'+l.toString()].shape[1]; j++) {\n                        c1_params['W'+l.toString()].set(i, j, c1_params['W'+l.toString()].get(i, j) < -1 ? -1 : c1_params['W'+l.toString()].get(i, j));\n                        c1_params['W'+l.toString()].set(i, j, c1_params['W'+l.toString()].get(i, j) > 1 ? 1 : c1_params['W'+l.toString()].get(i, j));\n                        c2_params['W'+l.toString()].set(i, j, c2_params['W'+l.toString()].get(i, j) < -1 ? -1 : c2_params['W'+l.toString()].get(i, j));\n                        c2_params['W'+l.toString()].set(i, j, c2_params['W'+l.toString()].get(i, j) > 1 ? 1 : c2_params['W'+l.toString()].get(i, j));\n                        c1_params['b'+l.toString()].set(i, j, c1_params['b'+l.toString()].get(i, j) < -1 ? -1 : c1_params['b'+l.toString()].get(i, j));\n                        c1_params['b'+l.toString()].set(i, j, c1_params['b'+l.toString()].get(i, j) > 1 ? 1 : c1_params['b'+l.toString()].get(i, j));\n                        c2_params['b'+l.toString()].set(i, j, c2_params['b'+l.toString()].get(i, j) < -1 ? -1 : c2_params['b'+l.toString()].get(i, j));\n                        c2_params['b'+l.toString()].set(i, j, c2_params['b'+l.toString()].get(i, j) > 1 ? 1 : c2_params['b'+l.toString()].get(i, j));\n                    }\n                }\n            }\n\n            // Create children from chromosomes generated above\n            var c1 = new Paddle(p5, 0, board_size[1]/2-45, 0, board_size, c1_params,\n                        props.settings['hiddenLayerArchitecture'], \n                        settings['hidden_layer_activation', \n                        settings['output_activation']]);\n            var c2 = new Paddle(p5, 0, board_size[1]/2-45, 0, board_size, c2_params,\n                        props.settings['hiddenLayerArchitecture'], \n                        settings['hidden_layer_activation', \n                        settings['output_activation']]);\n\n            // Add children to the next generation\n            next_pop.push(...[c1,c2]);\n        }\n        shuffle(next_pop);\n        population.individuals = next_pop;\n        \n    }\n\n    const _crossover = (parent1_weights, parent2_weights, parent1_bias, parent2_bias) => {\n        const rand_crossover = random.float();\n        var crossover_bucket = null;\n        for (var i = 1; i < _crossover_bins.length; i++) {\n            if (rand_crossover < _crossover_bins[i])\n                crossover_bucket = i-1;\n        }\n        var child1_weights = null;\n        var child2_weights = null;\n        var child1_bias = null;\n        var child2_bias = null;\n\n        // SBX\n        if (crossover_bucket === 0) {\n            [child1_weights, child2_weights] =  SBX(parent1_weights, parent2_weights, _SBX_eta);\n            [child1_bias, child2_bias] = SBX(parent1_bias, parent2_bias, _SBX_eta);\n        }\n\n        // Single point binary crossover (SPBX)\n        else if (crossover_bucket === 1) {\n            [child1_weights, child2_weights] = single_point_binary_crossover(parent1_weights, parent2_weights, _SPBX_type);\n            [child1_bias, child2_bias] =  single_point_binary_crossover(parent1_bias, parent2_bias, _SPBX_type);\n        }\n\n        else\n            throw new Error('Unable to determine valid crossover based off probabilities');\n        \n        return [child1_weights, child2_weights, child1_bias, child2_bias];\n    }\n\n    const _mutation = (child1_weights, child2_weights, child1_bias, child2_bias) => {\n        const scale = 0.2;\n        const rand_mutation = random.float();\n        var mutation_bucket = null;\n        for (var i = 1; i < _mutation_bins.length; i++) {\n            if (rand_mutation < _mutation_bins[i])\n                mutation_bucket = i-1;\n        }\n\n        var mutation_rate = _mutation_rate;\n        if (props.settings['mutationRateType'].toLowerCase() === 'decaying')\n            mutation_rate = mutation_rate / Math.sqrt(current_generation + 1);\n        \n        if (mutation_bucket === 0) {\n            // Mutate weights\n            gaussian_mutation(child1_weights, mutation_rate, scale);\n            gaussian_mutation(child2_weights, mutation_rate, scale);\n\n            // Mutate bias\n            gaussian_mutation(child1_bias, mutation_rate, scale);\n            gaussian_mutation(child2_bias, mutation_rate, scale);\n        }\n        \n        // Uniform random\n        else if (mutation_bucket === 1) {\n            // Mutate weights\n            random_uniform_mutation(child1_weights, mutation_rate, -1, 1);\n            random_uniform_mutation(child2_weights, mutation_rate, -1, 1);\n\n            // Mutate bias\n            random_uniform_mutation(child1_bias, mutation_rate, -1, 1);\n            random_uniform_mutation(child2_bias, mutation_rate, -1, 1);\n        }\n\n        else\n            throw new Error('Unable to determine valid mutation based off probabilities.');\n    }\n\n    const shuffle = array => {\n        var currentIndex = array.length, temporaryValue, randomIndex;\n      \n        // While there remain elements to shuffle...\n        while (0 !== currentIndex) {\n      \n          // Pick a remaining element...\n          randomIndex = Math.floor(Math.random() * currentIndex);\n          currentIndex -= 1;\n      \n          // And swap it with the current element.\n          temporaryValue = array[currentIndex];\n          array[currentIndex] = array[randomIndex];\n          array[randomIndex] = temporaryValue;\n        }\n      \n        return array;\n    }\n\n\n    return (\n        <div>\n            <Sketch setup={setup} draw={draw} />\n        </div>\n    );\n}\n\nexport default React.memo(Pong, (prevProps, nextProps) => {return true});","export class colorGrid {\n  constructor(color) {\n      const colorList = {\n          red: \"#B22222\", purple: \"#4B0082\", green: \"#9ACD32\",\n          blue: \"#6495ED\", yellow: \"#DAA520\", black: \"#333333\",\n      };\n      if (color in colorList) {\n          this.color = colorList[color];\n      } else {\n          this.color = color;\n      }\n  }\n  draw(ctx, x, y, w, h) {\n      ctx.fillStyle = this.color;\n      ctx.fillRect(x, y, w, h);\n  }\n}\n\nexport class Rect {\n  constructor(x, y, w, h){\n      this.x = x;\n      this.y = y;\n      this.w = w;\n      this.h = h;\n  }\n\n  draw(context, sprite) {\n      sprite.draw(context, this.x, this.y, this.w, this.h);\n  }\n\n  contains(point) {\n      // check whether p is in [x,x+w) x [y,y+h)\n      // inclusive in x and y; exclusive in x+w, y+h\n      var x = point[0];\n      var y = point[1];\n      if (\n        x >= this.x &&\n        x < this.x + this.w  &&\n        y >= this.y &&\n        y < this.y + this.h\n      ) {\n          return true;\n      } else {\n          return false;\n      }\n  }\n\n  collideRect(rect, overlap=true){\n      if (!(overlap)) {\n          // weak collision detection:\n          // point collision; does not consider area overlap\n          if (this.x == rect.x || this.y == rect.y){\n              return true;\n          } else {\n              return false;\n          }\n      } else {\n          // strong collision; detects area collision\n          if (this.contains([rect.x, rect.y])\n          || rect.contains([this.x, this.y])){\n              return true;\n          } else {\n              return false;\n          }\n      }\n  }\n}\n\nexport var Sprite = function(fname) {\n\n    // Static Variables\n    var TO_RADIAN = Math.PI/180;\n\n    // Instance Variables\n    this.image = null;\n    if (fname != undefined && fname != '' && fname != null) {\n        this.image = new Image();\n        this.image.src = fname;\n        //console.log([this.image.width, this.image.height]);\n    } else {\n      console.log('cannot load file');\n    }\n\n    // Instance Methods\n\n    // draw: start from top-left point\n    this.draw = function(ctx, x, y, w, h) {\n      // ctx.context.scale(ctx.dpr, ctx.dpr);\n      if (w == undefined || h == undefined) {\n        ctx.drawImage(this.image, x, y);\n      } else {\n        ctx.drawImage(this.image, x, y, w, h);\n      }\n    };\n\n    // rotate image: from center of the image\n    this.rotate = function(ctx, x, y, angle) {\n      ctx.save();\n      ctx.scale(ctx.dpr, ctx.dpr);\n      ctx.translate(x, y);\n      ctx.rotate(angle * this.TO_RADIAN);\n      ctx.drawImage(this.image, -this.image.width/2, -this.image.height/2);\n      ctx.restore();\n    };\n};\n\nexport default Sprite;","import {Rect} from \"./sprite\"\n\nexport function getRandInt(min=0, max, step=1) {\n    // return an random integer from min to max\n    // range is [min, max), inclusive in min but not max\n    var min = Math.ceil(min);\n    var max = Math.floor(max);\n    var rand = min + step*Math.floor(Math.random()*(max-min)/step);\n    return rand;\n}\n\nexport function arrayEqual(a, b, compare=(x,y)=>x==y) {\n    /*\n    checks whether two array of \"==\"-comparable elements are equal\n    NOT intended for comparing elements that are NOT \"==\" comparable\n    extension: now you can use \"compare\" function; default is \"==\"\n    */\n    if (a === b) return true;\n    if (a == null || b == null) return false;\n    if (a.length != b.length) return false;\n\n    for (var i = 0; i < a.length; i++) {\n        if (!(compare(a[i], b[i]))) return false;\n    }\n    return true;\n}\n\nexport function arrayContains(arr, obj, compare) {\n    /* check if obj equals to an element of arr with \"compare\"*/\n    if (arr == null) return false;\n    var boo = false;\n    arr.forEach((item, i) => {\n        if (compare(item, obj)) boo = true;\n    });\n    return boo;\n}\n\nString.prototype.format = function () {\n    // string formatter\n    var i = 0, args = arguments;\n    return this.replace(/{}/g, function () {\n        return typeof args[i] != 'undefined' ? args[i++] : '';\n    });\n};\n\nexport function to_csv(array2d) {\n    // convert 2d array to csv\n    var csvContent = \"data:text/csv;charset=utf-8,\" \n    + array2d.map(e => e.join(\",\")).join(\"\\n\");\n    return csvContent;\n}\n\nexport function download(content, fileName) {\n    var encodedUri = encodeURI(content);\n    var link = document.createElement(\"a\");\n\n    link.setAttribute(\"href\", encodedUri);\n    link.setAttribute(\"download\", fileName);\n    document.body.appendChild(link);\n    link.click();\n}\n\nexport function generateExtraWalls(array2d, size, pix) {\n    if (array2d == null) return null;\n    var walls = [];\n    array2d.forEach(([x,y], i) => {\n        if (pix) {\n            x *= size; \n            y *= size;\n        }\n        walls.push(new Rect(x, y, size, size));\n    });\n    return walls;\n}\n\nexport function euclidean(p1, p2) {\n    const [x1, y1] = p1;\n    const [x2, y2] = p2;\n    return Math.sqrt((x1-x2)**2 + (y1-y2)**2);\n}\n\nexport function random_choice(array) {\n    const rand_idx = getRandInt(0, array.length);\n    return array[rand_idx];\n}\n\nexport function random_sample(array, batch_size) {\n    if (array.length < batch_size) return array;\n\n    var array_copy = array.map((item, i) => item);\n    var sample = [];\n    for (var i = 0; i < batch_size; i++) {\n        var rand_idx = getRandInt(0, array_copy.length);\n        sample.push(\n            array_copy.splice(rand_idx, 1)[0]\n        );\n    }\n    return sample;\n}\n\n// https://stackoverflow.com/questions/11488014/asynchronous-process-inside-a-javascript-for-loop\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Promise","var nj = require('@aas395/numjs');\nconst random = require('random');\n\nexport const sigmoid = x => {return 1.0 / (1.0 + nj.exp(-x))};\nexport const tanh = x => {return nj.tanh(x)};\nexport const relu = x => {\n    var arr = [];\n    for (var i of x) {\n        if (i >= 0)\n            arr.push(i);\n        else\n            arr.push([0]);\n    }\n    return arr;\n};\nexport const linear = x => x;\n\nexport class FeedForwardNetwork {\n    constructor(layer_nodes, hidden_activation, output_activation, init_method='uniform', seed=null) {\n        this.params = {};\n        this.layer_nodes = layer_nodes;\n        this.hidden_activation = hidden_activation;\n        this.output_activation = output_activation;\n        this.inputs = null;\n        this.out = null;\n\n        // Initialize weights and bias\n        for (var l=1; l < this.layer_nodes.length; l++) {\n            if (init_method == 'uniform') {\n                var arrW = []\n                for (var i=0; i < this.layer_nodes[l]; i++) {\n                    var arr = []\n                    for (var j=0; j < this.layer_nodes[l-1]; j++) {\n                        arr.push(random.uniform(-1,1)());\n                    }\n                    arrW.push(arr);\n                }\n                var arrb = [];\n                for (var i=0; i < this.layer_nodes[l]; i++) {\n                    arrb.push([random.uniform(-1,1)()]);\n                }\n                this.params['W' + l.toString()] = arrW;\n                this.params['b' + l.toString()] = arrb;\n            } else {\n                throw new Error('Implement more options, bro');\n            }\n            \n            this.params['A' + l.toString()] = null;\n        }\n    }\n\n    feed_forward = (X) => {\n        var A_prev = X;\n        const L = this.layer_nodes.length - 1;\n        var W = null;\n        var b = null;\n        var Z = null;\n        // Feed hidden layers\n        for (var l=1; l<L; l++) {\n            W = this.params['W' + l.toString()];\n            b = this.params['b' + l.toString()];\n            // console.log(W, A_prev);\n            // console.log('dot', typeof nj.dot(W,A_prev), nj.dot(W, A_prev))\n            // console.log('b', typeof nj.array(b), nj.array(b))\n            Z = nj.dot(W, A_prev).add(nj.array(b));\n            // console.log('Z', typeof Z, Z)\n            A_prev = this.hidden_activation(Z.tolist());\n            // console.log('A_prev', A_prev)\n            this.params['A' + l.toString()] = A_prev;\n        }\n\n        W = this.params['W' + L.toString()];\n        b = this.params['b' + L.toString()];\n        Z = nj.dot(W, A_prev).add(nj.array(b));\n        const out = this.hidden_activation(Z.tolist());\n        this.params['A'+L.toString()] = out;\n        for (var i=0; i<out.length; i++) {\n            if (this.out === null)\n                this.out = i;\n            else {\n                if (out[i][0] > this.out)\n                    this.out = i\n            }\n        }\n        // console.log('a', out)\n        // console.log('out', this.out)\n        return this.out;\n    }\n}\n\nexport const get_activation_by_name = name => {\n    const activations = [['relu', relu],\n                        ['sigmoid', sigmoid],\n                        ['linear', linear],\n                        ['tanh', tanh]\n                        ]\n    var func = [];\n    for (var i=0; i<activations.length; i++) {\n        if (activations[i][0] === name.toLowerCase())\n            func.push(activations[i][1]);\n    }\n    console.assert(func.length == 1);\n    return func[0];\n}","import Individual from '../../genetic_algorithm/individual';\nimport * as util from '../reinforcement_learning/util';\nimport { colorGrid, Rect } from '../reinforcement_learning/sprite';\nimport {FeedForwardNetwork, linear, sigmoid, tanh, relu, get_activation_by_name} from './neural_network';\n\n// var nj = require('numjs');\n\nexport class Snake_ extends Individual{\n    constructor(p5, x=200, y=200, length, direction, boxSize, boardSize, chromosome=null, hidden_layer_architecture=[20,12], hidden_activation='relu', output_activation='sigmoid') {\n        super(Individual());\n        this.x = x\n        this.y = y\n        this.length = length\n        this.direction = direction\n        this.boxSize = boxSize\n        this.board_size = boardSize\n        this.body = []\n        this.initialize();\n        this.head = this.body[0];\n\n        this._fitness = 0\n        this.is_alive = true\n        this.reach_apple = false\n        this.apples = 0\n        this.total_steps = 0\n        this.steps = 0\n        this.distance = 0\n\n        this.winner = false\n        this.champion = false\n\n        this.hidden_layer_architecture = hidden_layer_architecture;\n        this.hidden_activation = hidden_activation;\n        this.output_activation = output_activation;\n\n        // Setting up network architecture\n        // Each \"Vision\" has 3 distances it tracks: wall, apple and this\n        // there are also one-hot encoded direction and one-hot encoded tail direction,\n        // each of which have 4 possibilities.\n        const num_inputs = 12 \n        this.network_architecture = [num_inputs]                          // Inputs\n        this.network_architecture.push(...this.hidden_layer_architecture)  // Hidden layers\n        this.network_architecture.push(3)                               // 3 outputs, ['left', 'still', 'right']\n        this.network = new FeedForwardNetwork(this.network_architecture,\n                                          get_activation_by_name(this.hidden_activation),\n                                          get_activation_by_name(this.output_activation)\n        )\n\n        // If chromosome is set, take it\n        if (chromosome) {\n            // this._chromosome = chromosome\n            this.network.params = chromosome\n            // this.decode_chromosome()\n        } else {\n            // this._chromosome = {}\n            // this.encode_chromosome()\n        }\n        \n    }\n\n    initialize() {\n        var k1 = 0; var k2 = 0;\n        if (this.direction == \"R\") k1 = -1;\n        if (this.direction == \"L\") k1 = 1;\n        if (this.direction == \"U\") k2 = 1;\n        if (this.direction == \"D\") k2 = -1;\n\n        for (var i = 0; i < this.length; i++){\n            var tempRect = new Rect(\n                this.x + k1*i * this.boxSize,\n                this.y + k2*i * this.boxSize,\n                this.boxSize, this.boxSize\n            );\n            this.body.push(tempRect);\n        }\n    }\n\n    fitness = () => {\n        return this.fitness;\n    }\n\n    calculate_fitness = () => {\n        this.fitness = this.total_steps + (2 ** this.apples + 500 * this.apples ** 2.1) - (0.25 * this.total_steps ** 1.3 * this.apples ** 1.2);\n        this.fitness = Math.max(this.fitness, .1);\n    }\n\n    reset = () => {\n        this._fitness = 0\n        this.apples = 0\n        this.is_alive = true\n        this.steps = 0\n        this.total_steps = 0\n        this.distance = 0\n        this.x = 200\n        this.y = 200\n        this.length = 3\n\n        this.initialize();\n        this.head = this.body[0];\n    }\n\n    updateDirection = (inputs) => {\n        this.network.feed_forward(inputs);\n        if (this.network.out === 0) {\n            if (this.direction !== \"D\")\n                this.direction = \"U\";\n        }\n        else if (this.network.out === 1) {\n            if (this.direction !== \"U\")\n                this.direction = \"D\";\n        }\n        else if (this.network.out === 2) {\n            if (this.direction !== \"L\")\n                this.direction = \"R\";\n        }\n        else if (this.network.out === 3) {\n            if (this.direction !== \"R\")\n                this.direction = \"L\";\n        }\n    }\n\n    // move a step forward\n    addHead(collideWall=true) {\n        var k1 = 0; var k2 = 0;\n        if (this.direction == \"R\") k1 = 1;\n        if (this.direction == \"L\") k1 = -1;\n        if (this.direction == \"U\") k2 = -1;\n        if (this.direction == \"D\") k2 = 1;\n\n        if (!(collideWall)) {\n            this.x = (this.x + k1*this.boxSize) % this.board_size[0];\n            this.y = (this.y + k2*this.boxSize) % this.board_size[1];\n        } else {\n            this.x = (this.x + k1*this.boxSize);\n            this.y = (this.y + k2*this.boxSize);\n        }\n\n        var newHead = new Rect(\n            this.x, this.y,\n            this.boxSize, this.boxSize\n        );\n        this.body.unshift(newHead);\n        this.head = this.body[0];\n    }\n\n    deleteTail() {\n        return this.body.pop();\n    }\n\n    collideWithBody() {\n        for (var i = 1; i < this.body.length; i++) {\n            var part = this.body[i];\n            if (this.head.collideRect(part)) {\n                return true\n            }\n        }\n        return false;\n    }\n\n    collideWithWall(extraWalls=null) {\n        // normal wall check\n        var wallRect = new Rect(0, 0, this.board_size[0], this.board_size[1]);\n        if ( !(wallRect.contains([this.x, this.y])) ) {\n            return true;\n        }\n        // extra wall check\n        if (extraWalls == null) return false;\n\n        var bool = false;\n        extraWalls.forEach(part => {\n            if (this.head.collideRect(part)) {\n                bool = true;\n            }\n        });\n        return bool;\n    }\n\n    draw(p5) {\n        p5.fill(\"#7ffc03\");\n        for (var i=0; i < this.body.length; i++) {\n            var rect = this.body[i];\n            p5.rect(rect.x, rect.y, this.boxSize, this.boxSize);\n        }\n    }\n}\n\nexport class Apple {\n    /*\n    Apple Object for the snake game.\n    Attributes:\n    - boxLength\n    - x\n    - y\n    */\n    constructor(boxLength, x, y, board_x, board_y) {\n        this.boxLength = boxLength;\n        this.x = x;\n        this.y = y;\n        this.board_x = board_x;\n        this.board_y = board_y;\n        this.rect = new Rect(this.x, this.y, this.boxLength, this.boxLength);\n    }\n\n    // avoid: list of (x,y) arrays\n    move(avoid=null) {\n      const avoidCompare = (a, b) => util.arrayEqual(a, b);\n      while (true) {\n          var rand_x = util.getRandInt(0, this.board_x, this.boxLength);\n          var rand_y = util.getRandInt(0, this.board_y, this.boxLength);\n          var inAvoid = util.arrayContains(avoid, [rand_x,rand_y], avoidCompare);\n          if (avoid == null || !(inAvoid)){\n              break;\n          }\n      }\n      // to do construct a more efficient random for large avoid.\n      this.rect = new Rect(rand_x, rand_y, this.boxLength, this.boxLength);\n      this.x = rand_x;\n      this.y = rand_y;\n    }\n\n    draw(p5) {\n        p5.fill('#ff0000');\n        p5.rect(this.x, this.y, this.boxLength, this.boxLength);\n        // p5.rect(0,0,50,50);\n    }\n}","const settings = {\n    // Hidden layer activation is specific to hidden layers, i.e. all layers except the input and output\n    'hidden_layer_activation':     'relu',     // Options are [relu, sigmoid, tanh, linear, leaky_relu]\n    // Output layer activation is specific to the output layer \n    'output_layer_activation':     'sigmoid',  // Options are [relu, sigmoid, tanh, linear, leaky_relu]\n    // Hidden network architecture describes the number of nodes in each hidden layer\n    'hidden_network_architecture': [12, 20, 12],   // A list containing number of nodes in each hidden layer\n\n    //### GA stuff ####\n\n    //# Mutation ##\n\n    // Mutation rate is the probability that a given gene in a chromosome will randomly mutate\n    'mutation_rate':               0.05,       // Value must be between [0.00, 1.00)\n    // If the mutation rate type is static, then the mutation rate will always be `mutation_rate`,\n    // otherwise if it is decaying it will decrease as the number of generations increase\n    'mutation_rate_type':          'static',   // Options are [static, decaying]\n    // The probability that if a mutation occurs, it is gaussian\n    'probability_gaussian':        1.0,        // Values must be between [0.00, 1.00]\n    // The probability that if a mutation occurs, it is random uniform\n    'probability_random_uniform':  0.0,        // Values must be between [0.00, 1.00]\n\n    //# Crossover ##\n    \n    // eta related to SBX. Larger values create a distribution closer around the parents while smaller values venture further from them.\n    // Only used if probability_SBX > 0.00\n    'SBX_eta':                     100,\n    // Probability that when crossover occurs, it is simulated binary crossover\n    'probability_SBX':             1,\n    // The type of SPBX to consider. If it is 'r' then it flattens a 2D array in row major ordering.\n    // If SPBX_type is 'c' then it flattens a 2D array in column major ordering.\n    'SPBX_type':                   'r',        // Options are 'r' for row or 'c' for column\n    // Probability that when crossover occurs, it is single point binary crossover\n    'probability_SPBX':            0,\n    // Crossover selection type determines the way in which we select individuals for crossover\n    'crossover_selection_type':    'roulette_wheel',\n\n    //# Selection ##\n\n    // Number of parents that will be used for reproducing\n    'num_parents':                 50,\n    // Number of offspring that will be created. Keep num_offspring >= num_parents\n    'num_offspring':               100,\n    // The selection type to use for the next generation.\n    // If selection_type == 'plus':\n    //     Then the top num_parents will be chosen from (num_offspring + num_parents)\n    // If selection_type == 'comma':\n    //     Then the top num_parents will be chosen from (num_offspring)\n    // @NOTE: if the lifespan of the individual is 1, then it cannot be selected for the next generation\n    // If enough indivduals are unable to be selected for the next generation, new random ones will take their place.\n    // @NOTE: If selection_type == 'comma' then lifespan is ignored.\n    //   This is equivalent to lifespan = 1 in this case since the parents never make it to the new generation.\n    'selection_type':              'plus',     // Options are ['plus', 'comma']\n}\n\nexport default settings;","import React from 'react';\nimport Sketch from 'react-p5';\nimport { Snake_, Apple } from './snakeClass';\nimport settings from './settings';\nimport Population from '../../genetic_algorithm/population';\nimport {FeedForwardNetwork, sigmoid, linear, relu} from './neural_network';\nimport {elitism_selection, roulette_wheel_selection} from '../../genetic_algorithm/selection';\nimport {gaussian_mutation, random_uniform_mutation} from '../../genetic_algorithm/mutation';\nimport {simulated_binary_crossover as SBX} from '../../genetic_algorithm/crossover';\nimport {uniform_binary_crossover, single_point_binary_crossover} from '../../genetic_algorithm/crossover';\nconst random = require('random');\nvar nj = require('@aas395/numjs');\n\nfunction Snake(props) {\n    const cumulativeSum = (sum => value => sum += value)(0);\n    var _mutation_bins = [settings['probability_gaussian'], settings['probability_random_uniform']].map(cumulativeSum);\n    var _crossover_bins = [settings['probability_SBX'], settings['probability_SPBX']].map(cumulativeSum);\n    var _SPBX_type = settings['SPBX_type'].toLowerCase();\n    var _SBX_eta = settings['SBX_eta'];\n    var _mutation_rate = props.settings['mutationRate'];\n\n    // Determine size of next gen based off selection type\n    var _next_gen_size = null;\n    if (settings['selection_type'].toLowerCase() == 'plus')\n        _next_gen_size = props.settings['numParents'] + props.settings['numOffsprings'];\n    else if (settings['selection_type'].lower() == 'comma')\n        _next_gen_size = props.settings['numOffsprings'];\n    else\n        throw new Error('Selection type \"{}\" is invalid'.format(settings['selectionType']));\n\n    var board_size = props.dimension;\n\n    var individuals = [];\n\n    var population = new Population(individuals);\n    var current_generation = 0;\n    var winner = null;\n    var winner_index = -1;\n    var champion = null;\n    var champion_index = -1;\n    var champion_fitness = Number.NEGATIVE_INFINITY;\n\n    var num_apples = 0;\n    var best_apples = 0;\n\n    var apple = null;\n\n    const setup = (p5, canvasParentRef) => {\n        // use parent to render the canvas in this ref\n        // (without that p5 will render the canvas outside of your component)\n        p5.createCanvas(board_size[0], board_size[1]).parent(canvasParentRef);\n        for (var i=0; i < props.settings['numParents']; i++) {\n            const individual = new Snake_(p5, 200, 200, 3, random_direction(), 20, board_size, null,\n                                    props.settings['hiddenLayerArchitecture'], \n                                    settings['hidden_layer_activation', \n                                    settings['output_activation']]);\n            individuals.push(individual);\n        }\n        apple = new Apple(20, 100, 100, board_size[0], board_size[1]);\n        apple.move();\n        const button = p5.createButton('Return').parent(canvasParentRef);\n        button.position(30, 10);\n        button.style('background-color', '#8A2BE2')\n        button.mousePressed(props.updateStart);\n    };\n \n    const draw = (p5) => {\n        p5.background(0);\n        p5.textSize(20);\n        p5.fill('#FFFFFF');\n        p5.text('Generation: '+current_generation, board_size[0]-180, 30);\n        p5.text('Apples: '+num_apples, board_size[0]-180, 60);\n        p5.text('Best: '+best_apples, board_size[0]-180, 90);\n\n        apple.draw(p5);\n    \n        var still_alive = 0;\n        var not_reach_apple = 0;\n        // Loop through the paddles in the generation\n        for (var i=0; i < population.individuals.length; i++) {\n            var snake = population.individuals[i];\n\n            if (snake.is_alive) {\n                still_alive++;\n                if (!snake.reach_apple) {\n                    not_reach_apple++;\n                    //----------------------------------------inputs for neural network--------------------------------------------\n                    var new_state = Array(12).fill([0]);\n\n                    // Direction of Snake\n                    if (snake.direction == \"U\") {\n                        new_state[0] = [1];\n                    } else if (snake.direction == \"R\") {\n                        new_state[1] = [1];\n                    } else if (snake.direction == \"D\") {\n                        new_state[2] = [1];\n                    } else if (snake.direction == \"L\") {\n                        new_state[3] = [1];\n                    }\n\n                    // Apple position (wrt snake head)\n                    // (0,0) at Top-Left Corner: U: -y; R: +x\n                    if (apple.y < snake.y) {\n                        // apple north snake\n                        new_state[4] = [1]\n                    }\n                    if (apple.x > snake.x) {\n                        // apple east snake\n                        new_state[5] = [1]\n                    }\n                    if (apple.y > snake.y) {\n                        // apple south snake\n                        new_state[6] = [1]\n                    }\n                    if (apple.x < snake.x) {\n                        // apple west snake\n                        new_state[7] = [1]\n                    }\n\n                    // Obstacle (Walls, body) position (wrt snake head)\n                    var test_snake;\n                    const test_case = {\n                        \"U\": {oppo: \"D\", x: 0, y: -20, state: 8},\n                        \"R\": {oppo: \"L\", x: 20, y: 0, state: 9},\n                        \"D\": {oppo: \"U\", x: 0, y: 20, state: 10},\n                        \"L\": {oppo: \"R\", x: -20, y: 0, state: 11}\n                    };\n                    for (var key in test_case) {\n                        var test = test_case[key];\n                        if (snake.direction != test[\"oppo\"]) {\n                            test_snake = new Snake_(p5, snake.x + test['x'], snake.y+test['y'], 1, 'U', 20, board_size, null,\n                                        props.settings['hiddenLayerArchitecture'], \n                                        settings['hidden_layer_activation', \n                                        settings['output_activation']]);\n                            if (test_snake.collideWithWall()) {\n                                new_state[test[\"state\"]] = [1];\n                            }\n                        }\n                    }\n                    const inputs = new_state;\n                    //----------------------------------------inputs for neural network--------------------------------------------\n                    snake.updateDirection(inputs);\n                    const pos_cur = [snake.x, snake.y];\n                    snake.addHead();\n                    const pos_next = [snake.x, snake.y];\n                    const pos_apple = [apple.x, apple.y];\n                    const d1 = Math.hypot(pos_apple[0]-pos_cur[0], pos_apple[1]-pos_cur[1]);\n                    const d2 = Math.hypot(pos_apple[0]-pos_next[0], pos_apple[1]-pos_next[1]);\n                    if (d1 > d2)\n                        snake.distance++;\n                    else if (d1 < d2)\n                        snake.distance -= 1.1;\n                    if (snake.collideWithWall() || snake.collideWithBody()) {\n                        snake.is_alive = false;\n                    }\n                    if (!snake.head.collideRect(apple.rect)) {\n                        snake.deleteTail();\n                        snake.steps++;\n                        snake.total_steps++;\n                        if (snake.steps > board_size[0] / 2 + 20) {\n                            snake.total_steps = Number.POSITIVE_INFINITY;\n                            console.log('dead')\n                            snake.is_alive = false;\n                        } \n                    } else {\n                            snake.apples++;\n                            snake.steps = 0;\n                            snake.reach_apple = true;\n                    }\n                }\n            }\n\n            // Draw every paddle except the best ones\n            if (snake.is_alive && snake !== winner && snake !== champion) {\n                snake.draw(p5);\n            }\n        }\n\n        // Draw the winning and champion paddle last\n        if (winner !== null && winner.is_alive) {\n            winner.draw(p5);\n        }\n        if (champion !== null && champion.is_alive) {\n            champion.draw(p5);\n        }\n\n        if (not_reach_apple === 0) {\n            apple.move();\n            num_apples++;\n            if (num_apples > best_apples)\n                best_apples = num_apples;\n            for (var snake_ of population.individuals) {\n                if (snake_.is_alive) {\n                    snake_.steps = 0;\n                    snake_.reach_apple = false;\n                }\n            }\n        }\n\n        // Generate new generation when all have died out\n        if (still_alive === 0)\n            next_generation(p5);\n    };\n\n    const random_direction = () => {\n        const dir = ['U','D','L','R'];\n        var index = Math.floor(Math.random() * dir.length);\n        return dir[index];\n    }\n\n    const next_generation = (p5) => {\n        current_generation++;\n        num_apples = 0;\n        \n        // Calculate fitness of individuals\n        for (var individual of population.individuals)\n            individual.calculate_fitness();\n            console.log(individual.fitness)\n        \n        // Find winner from each generation and champion\n        winner = population.fittest_individual();\n        winner_index = population.individuals.indexOf(winner);\n        if (winner.fitness > champion_fitness) {\n            champion_fitness = winner.fitness;\n            champion = winner;\n            champion_index = winner_index;\n        }\n        winner.reset();\n        champion.reset();\n\n        // Print results from each generation\n        console.log('======================= Generation', current_generation, '=======================');\n        console.log('----Max fitness:', population.fittest_individual().fitness);\n        // print('----Best Score:', self.population.fittest_individual.score);\n        console.log('----Average fitness:', population.average_fitness());\n\n        props.addAvgFitness(population.average_fitness());\n        props.addMaxFitness(population.fittest_individual().fitness);\n        \n        population.individuals = elitism_selection(population, props.settings['numParents']);\n        population.individuals = shuffle(population.individuals);\n        var next_pop = [];\n\n        // parents + offspring selection type ('plus')\n        if (settings['selection_type'].toLowerCase() === 'plus') {\n            next_pop.push(winner);\n            next_pop.push(champion);\n        }\n\n        while (next_pop.length < _next_gen_size) {\n            var [p1, p2] = roulette_wheel_selection(population, 2);\n            const L = p1.network.layer_nodes.length;\n            var c1_params = {};\n            var c2_params = {};\n\n            // Each W_l and b_l are treated as their own chromosome.\n            // Because of this I need to perform crossover/mutation on each chromosome between parents\n            for (var l = 1; l < L; l++) {\n                const p1_W_l = p1.network.params['W' + l.toString()]\n                const p2_W_l = p2.network.params['W' + l.toString()]  \n                const p1_b_l = p1.network.params['b' + l.toString()]\n                const p2_b_l = p2.network.params['b' + l.toString()]\n\n                var c1_W_l = null, c2_W_l = null, c1_b_l = null, c2_b_l = null;\n\n                // Crossover\n                // @NOTE: I am choosing to perform the same type of crossover on the weights and the bias.\n                [c1_W_l, c2_W_l, c1_b_l, c2_b_l] = _crossover(p1_W_l, p2_W_l, p1_b_l, p2_b_l);\n\n                // Mutation\n                // @NOTE: I am choosing to perform the same type of mutation on the weights and the bias.\n                _mutation(c1_W_l, c2_W_l, c1_b_l, c2_b_l);\n\n                // Assign children from crossover/mutation\n                c1_params['W' + l.toString()] = c1_W_l;\n                c2_params['W' + l.toString()] = c2_W_l;\n                c1_params['b' + l.toString()] = c1_b_l;\n                c2_params['b' + l.toString()] = c2_b_l;\n\n                // Clip to [-1, 1]\n                for (var i=0; i<c1_params['W'+l.toString()].shape[0]; i++) {\n                    for (var j=0; j<c1_params['W'+l.toString()].shape[1]; j++) {\n                        c1_params['W'+l.toString()].set(i, j, c1_params['W'+l.toString()].get(i, j) < -1 ? -1 : c1_params['W'+l.toString()].get(i, j));\n                        c1_params['W'+l.toString()].set(i, j, c1_params['W'+l.toString()].get(i, j) > 1 ? 1 : c1_params['W'+l.toString()].get(i, j));\n                        c2_params['W'+l.toString()].set(i, j, c2_params['W'+l.toString()].get(i, j) < -1 ? -1 : c2_params['W'+l.toString()].get(i, j));\n                        c2_params['W'+l.toString()].set(i, j, c2_params['W'+l.toString()].get(i, j) > 1 ? 1 : c2_params['W'+l.toString()].get(i, j));\n                        c1_params['b'+l.toString()].set(i, j, c1_params['b'+l.toString()].get(i, j) < -1 ? -1 : c1_params['b'+l.toString()].get(i, j));\n                        c1_params['b'+l.toString()].set(i, j, c1_params['b'+l.toString()].get(i, j) > 1 ? 1 : c1_params['b'+l.toString()].get(i, j));\n                        c2_params['b'+l.toString()].set(i, j, c2_params['b'+l.toString()].get(i, j) < -1 ? -1 : c2_params['b'+l.toString()].get(i, j));\n                        c2_params['b'+l.toString()].set(i, j, c2_params['b'+l.toString()].get(i, j) > 1 ? 1 : c2_params['b'+l.toString()].get(i, j));\n                    }\n                }\n            }\n\n            // Create children from chromosomes generated above\n            var c1 = new Snake_(p5, 200, 200, 3, random_direction(), 20, board_size, c1_params,\n                        props.settings['hiddenLayerArchitecture'], \n                        settings['hidden_layer_activation', \n                        settings['output_activation']]);\n            var c2 = new Snake_(p5, 200, 200, 3, random_direction(), 20, board_size, c2_params,\n                        props.settings['hiddenLayerArchitecture'], \n                        settings['hidden_layer_activation', \n                        settings['output_activation']]);\n\n            // Add children to the next generation\n            next_pop.push(...[c1,c2]);\n        }\n        shuffle(next_pop);\n        population.individuals = next_pop;\n        \n    }\n\n    const _crossover = (parent1_weights, parent2_weights, parent1_bias, parent2_bias) => {\n        const rand_crossover = random.float();\n        var crossover_bucket = null;\n        for (var i = 1; i < _crossover_bins.length; i++) {\n            if (rand_crossover < _crossover_bins[i])\n                crossover_bucket = i-1;\n        }\n        var child1_weights = null;\n        var child2_weights = null;\n        var child1_bias = null;\n        var child2_bias = null;\n\n        // SBX\n        if (crossover_bucket === 0) {\n            [child1_weights, child2_weights] =  SBX(parent1_weights, parent2_weights, _SBX_eta);\n            [child1_bias, child2_bias] = SBX(parent1_bias, parent2_bias, _SBX_eta);\n        }\n\n        // Single point binary crossover (SPBX)\n        else if (crossover_bucket === 1) {\n            [child1_weights, child2_weights] = single_point_binary_crossover(parent1_weights, parent2_weights, _SPBX_type);\n            [child1_bias, child2_bias] =  single_point_binary_crossover(parent1_bias, parent2_bias, _SPBX_type);\n        }\n\n        else\n            throw new Error('Unable to determine valid crossover based off probabilities');\n        \n        return [child1_weights, child2_weights, child1_bias, child2_bias];\n    }\n\n    const _mutation = (child1_weights, child2_weights, child1_bias, child2_bias) => {\n        const scale = 0.2;\n        const rand_mutation = random.float();\n        var mutation_bucket = null;\n        for (var i = 1; i < _mutation_bins.length; i++) {\n            if (rand_mutation < _mutation_bins[i])\n                mutation_bucket = i-1;\n        }\n\n        var mutation_rate = _mutation_rate;\n        if (props.settings['mutationRateType'].toLowerCase() === 'decaying')\n            mutation_rate = mutation_rate / Math.sqrt(current_generation + 1);\n        \n        if (mutation_bucket === 0) {\n            // Mutate weights\n            gaussian_mutation(child1_weights, mutation_rate, scale);\n            gaussian_mutation(child2_weights, mutation_rate, scale);\n\n            // Mutate bias\n            gaussian_mutation(child1_bias, mutation_rate, scale);\n            gaussian_mutation(child2_bias, mutation_rate, scale);\n        }\n        \n        // Uniform random\n        else if (mutation_bucket === 1) {\n            // Mutate weights\n            random_uniform_mutation(child1_weights, mutation_rate, -1, 1);\n            random_uniform_mutation(child2_weights, mutation_rate, -1, 1);\n\n            // Mutate bias\n            random_uniform_mutation(child1_bias, mutation_rate, -1, 1);\n            random_uniform_mutation(child2_bias, mutation_rate, -1, 1);\n        }\n\n        else\n            throw new Error('Unable to determine valid mutation based off probabilities.');\n    }\n\n    const shuffle = array => {\n        var currentIndex = array.length, temporaryValue, randomIndex;\n      \n        // While there remain elements to shuffle...\n        while (0 !== currentIndex) {\n      \n          // Pick a remaining element...\n          randomIndex = Math.floor(Math.random() * currentIndex);\n          currentIndex -= 1;\n      \n          // And swap it with the current element.\n          temporaryValue = array[currentIndex];\n          array[currentIndex] = array[randomIndex];\n          array[randomIndex] = temporaryValue;\n        }\n      \n        return array;\n    }\n\n\n    return (\n        <div>\n            <Sketch setup={setup} draw={draw} />\n        </div>\n    );\n}\n\nexport default React.memo(Snake, (prevProps, nextProps) => {return true});","const settings = {\r\n    // #### Flappy Bird related ####\r\n\r\n    'Window_Width':                 600,//576,\r\n    'Window_Height':                300,//1024,\r\n    'gravity':                      0.25,\r\n\r\n    'init_bird_x_pos':              50,\r\n    'init_bird_y_pos':              55,\r\n\r\n    'bird_jump_speed':              -4,\r\n    'pipe_interval_in_frames':      30,//#72, // not in use\r\n\r\n    'pipe_interval_in_pixels':      300,\r\n\r\n\r\n\r\n    // #### Neural Network related stuff ####\r\n\r\n    // # Hidden layer activation is specific to hidden layers, i.e. all layers except the input and output\r\n    'hidden_layer_activation':     'relu',     //# Options are [relu, sigmoid, tanh, linear, leaky_relu]\r\n    // # Output layer activation is specific to the output layer \r\n    'output_layer_activation':     'sigmoid',  //# Options are [relu, sigmoid, tanh, linear, leaky_relu]\r\n    // # Hidden network architecture describes the number of nodes in each hidden layer\r\n\r\n    // 'hidden_network_architecture': [12, 20, 12],   //# A list containing number of nodes in each hidden layer\r\n    'hidden_network_architecture': [6,3],\r\n\r\n    // #### GA stuff ####\r\n\r\n    // ## Mutation ##\r\n\r\n    // # Mutation rate is the probability that a given gene in a chromosome will randomly mutate\r\n    'mutation_rate':               0.05,       //# Value must be between [0.00, 1.00)\r\n    // # If the mutation rate type is static, then the mutation rate will always be `mutation_rate`,\r\n    // # otherwise if it is decaying it will decrease as the number of generations increase\r\n    'mutation_rate_type':          'static',   //# Options are [static, decaying]\r\n    // # The probability that if a mutation occurs, it is gaussian\r\n    'probability_gaussian':        1.0,        //# Values must be between [0.00, 1.00]\r\n    // # The probability that if a mutation occurs, it is random uniform\r\n    'probability_random_uniform':  0.0,        //# Values must be between [0.00, 1.00]\r\n\r\n    // ## Crossover ##\r\n    \r\n    // # eta related to SBX. Larger values create a distribution closer around the parents while smaller values venture further from them.\r\n    // # Only used if probability_SBX > 0.00\r\n    'SBX_eta':                     100,\r\n    // # Probability that when crossover occurs, it is simulated binary crossover\r\n    'probability_SBX':             0.5,\r\n    // # The type of SPBX to consider. If it is 'r' then it flattens a 2D array in row major ordering.\r\n    // # If SPBX_type is 'c' then it flattens a 2D array in column major ordering.\r\n    'SPBX_type':                   'r',        //# Options are 'r' for row or 'c' for column\r\n    // # Probability that when crossover occurs, it is single point binary crossover\r\n    'probability_SPBX':            0.5,\r\n    // # Crossover selection type determines the way in which we select individuals for crossover\r\n    'crossover_selection_type':    'roulette_wheel',\r\n\r\n    // ## Selection ##\r\n\r\n    // # Number of parents that will be used for reproducing\r\n    'num_parents':                 50,\r\n    // # Number of offspring that will be created. Keep num_offspring >= num_parents\r\n    'num_offspring':               100,\r\n    // # The selection type to use for the next generation.\r\n    // # If selection_type == 'plus':\r\n    // #     Then the top num_parents will be chosen from (num_offspring + num_parents)\r\n    // # If selection_type == 'comma':\r\n    // #     Then the top num_parents will be chosen from (num_offspring)\r\n    // # @NOTE: if the lifespan of the individual is 1, then it cannot be selected for the next generation\r\n    // # If enough indivduals are unable to be selected for the next generation, new random ones will take their place.\r\n    // # @NOTE: If selection_type == 'comma' then lifespan is ignored.\r\n    // #   This is equivalent to lifespan = 1 in this case since the parents never make it to the new generation.\r\n    'selection_type':              'plus',     //# Options are ['plus', 'comma']\r\n\r\n\r\n\r\n\r\n\r\n    // // ## Individual ##\r\n\r\n    // // # How long an individual is allowed to be in the population before dying off.\r\n    // // # This can be useful for allowing exploration. Imagine a top individual constantly being selected for crossover.\r\n    // // # With a lifespan, after a number of generations, the individual will not be selected to participate in future\r\n    // // # generations. This can allow for other individuals to have higher selective pressure than they previously did.\r\n    // // # @NOTE this only matters if 'selecton_type' == 'plus'. If 'selection_type' == 'comma', then 'lifespan' is completely ignored.\r\n    // 'lifespan':                    np.inf,          //# Options are any positive integer or np.inf (typed out as if it were a number, i.e. no quotes to make it a string)\r\n    // // # The type of vision the snake has when it sees itself or the apple.\r\n    // // # If the vision is binary, then the input into the Neural Network is 1 (can see) or 0 (cannot see).\r\n    // // # If the vision is distance, then the input into the Neural Network is 1.0/distance.\r\n    // // # 1.0/distance is used to keep values capped at 1.0 as a max.\r\n    // 'apple_and_self_vision':       'binary'    //# Options are ['binary', 'distance'] \r\n\r\n}\r\n\r\nexport default settings;","var nj = require('@aas395/numjs');\nconst random = require('random');\n\nexport const sigmoid = x => {return 1.0 / (1.0 + nj.exp(-x))};\nexport const tanh = x => {return nj.tanh(x)};\nexport const relu = x => {\n    var arr = [];\n    for (var i of x) {\n        if (i >= 0)\n            arr.push(i);\n        else\n            arr.push([0]);\n    }\n    return arr;\n};\nexport const linear = x => x;\n\nexport class FeedForwardNetwork {\n    constructor(layer_nodes, hidden_activation, output_activation, init_method='uniform', seed=null) {\n        this.params = {};\n        this.layer_nodes = layer_nodes;\n        this.hidden_activation = hidden_activation;\n        this.output_activation = output_activation;\n        this.inputs = null;\n        this.out = null;\n\n        // Initialize weights and bias\n        for (var l=1; l < this.layer_nodes.length; l++) {\n            if (init_method == 'uniform') {\n                var arrW = []\n                for (var i=0; i < this.layer_nodes[l]; i++) {\n                    var arr = []\n                    for (var j=0; j < this.layer_nodes[l-1]; j++) {\n                        arr.push(random.uniform(-1,1)());\n                    }\n                    arrW.push(arr);\n                }\n                var arrb = [];\n                for (var i=0; i < this.layer_nodes[l]; i++) {\n                    arrb.push([random.uniform(-1,1)()]);\n                }\n                this.params['W' + l.toString()] = arrW;\n                this.params['b' + l.toString()] = arrb;\n            } else {\n                throw new Error('Implement more options, bro');\n            }\n            \n            this.params['A' + l.toString()] = null;\n        }\n    }\n\n    feed_forward = (X) => {\n        var A_prev = X;\n        const L = this.layer_nodes.length - 1;\n        var W = null;\n        var b = null;\n        var Z = null;\n        // Feed hidden layers\n        for (var l=1; l<L; l++) {\n            W = this.params['W' + l.toString()];\n            b = this.params['b' + l.toString()];\n            // console.log(W, A_prev);\n            // console.log('dot', typeof nj.dot(W,A_prev), nj.dot(W, A_prev))\n            // console.log('b', typeof nj.array(b), nj.array(b))\n            Z = nj.dot(W, A_prev).add(nj.array(b));\n            // console.log('Z', typeof Z, Z)\n            A_prev = this.hidden_activation(Z.tolist());\n            // console.log('A_prev', A_prev)\n            this.params['A' + l.toString()] = A_prev;\n        }\n\n        W = this.params['W' + L.toString()];\n        b = this.params['b' + L.toString()];\n        Z = nj.dot(W, A_prev).add(nj.array(b));\n        const out = this.hidden_activation(Z.tolist());\n        this.params['A'+L.toString()] = out;\n        for (var i=0; i<out.length; i++) {\n            if (this.out === null)\n                this.out = i;\n            else {\n                if (out[i][0] > this.out)\n                    this.out = i\n            }\n        }\n        // console.log('a', out)\n        // console.log('out', this.out)\n        return this.out;\n    }\n}\n\nexport const get_activation_by_name = name => {\n    const activations = [['relu', relu],\n                        ['sigmoid', sigmoid],\n                        ['linear', linear],\n                        ['tanh', tanh]\n                        ]\n    var func = [];\n    for (var i=0; i<activations.length; i++) {\n        if (activations[i][0] === name.toLowerCase())\n            func.push(activations[i][1]);\n    }\n    console.assert(func.length == 1);\n    return func[0];\n}","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAYBAMAAABtiDI6AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAHlBMVEUAAABTOEZU0f/6+vpLwfjX5sz82ITkYBhApNL///8xUeTGAAAAAXRSTlMAQObYZgAAAAFiS0dECfHZpewAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfjAwwAAhPn+iW4AAAAa0lEQVQY04XRUQ3AIAwE0Fo4C1jAQi3MAhawgOwdpdvYCtn93UsooYhYYJEpXwFSSsgZe2FXJTwUBOyUg+AUBKr/0uO0Ebs1G/lLFlIIhYJqwULG5NZQ741EEdYeXIdWIhg2LTaKT59/4iUna5Q61/PQYY0AAAAldEVYdGRhdGU6Y3JlYXRlADIwMTktMDMtMTFUMTg6MDI6MTkrMDY6MDDhKjnDAAAAJXRFWHRkYXRlOm1vZGlmeQAyMDE5LTAzLTExVDE4OjAyOjE5KzA2OjAwkHeBfwAAAABJRU5ErkJggg==\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAYBAMAAABtiDI6AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAAG1BMVEUAAABTOEb8cw/6+vr8OADX5sz4tzPTLwD///9hx+6LAAAAAXRSTlMAQObYZgAAAAFiS0dECIbelXoAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfjAwwAAhPn+iW4AAAAaklEQVQY04XR0Q3AIAgEUFa4FVzBFVjBFVzB9XsitbZoen+8KAYUscAiS74CpJSQM87CWpXwUBCwphSCUxCo/kuP00Hs1Wzkk2ykHy4UVAs2Mjq3hjo3EkVY9uC+tBPBsGWxUbz7+hMvuQDnyDdBQ+XoXAAAACV0RVh0ZGF0ZTpjcmVhdGUAMjAxOS0wMy0xMVQxODowMjoxOSswNjowMOEqOcMAAAAldEVYdGRhdGU6bW9kaWZ5ADIwMTktMDMtMTFUMTg6MDI6MTkrMDY6MDCQd4F/AAAAAElFTkSuQmCC\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACIAAAAYBAMAAABtiDI6AAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JQAAgIMAAPn/AACA6QAAdTAAAOpgAAA6mAAAF2+SX8VGAAAAG1BMVEUAAABTOEb614z6+vr4tzPX5sz8OADggCz///+gdOUrAAAAAXRSTlMAQObYZgAAAAFiS0dECIbelXoAAAAJcEhZcwAACxMAAAsTAQCanBgAAAAHdElNRQfjAwwAAhPn+iW4AAAAaUlEQVQY04XR0Q3AIAgEUFa4FVjBFVihK7iC6/dE2tqi6f3dS8SIIh54ZMpXAFVFKdgLuxnhoSRgpxyEoCQw+5eeoI34rcUpXrIQJSgF1YOFjMmtod4bySKsPbgOrUQwbFpslpg+/8RLTmK0NnWK1qPLAAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTAzLTExVDE4OjAyOjE5KzA2OjAw4So5wwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0wMy0xMVQxODowMjoxOSswNjowMJB3gX8AAAAASUVORK5CYII=\"","import settings from './settings';\r\nimport Individual from '../genetic_algorithm/individual';\r\nimport {FeedForwardNetwork, linear, sigmoid, tanh, relu, get_activation_by_name} from './neural_network';\r\nimport bluebird_sprite from \"./assets/bluebird-midflap.png\"\r\nimport redbird_sprite from \"./assets/redbird-midflap.png\"\r\nimport yellowbird_sprite from \"./assets/yellowbird-midflap.png\"\r\n\r\n\r\n\r\nclass Bird extends Individual{\r\n    constructor(p5, \r\n                chromosome=null, \r\n                hidden_layer_architecture=[12, 20], \r\n                hidden_activation='relu', \r\n                output_activation='sigmoid',\r\n                x_pos=settings['init_bird_x_pos'], \r\n                y_pos=settings['init_bird_y_pos'],\r\n                y_speed=0) {\r\n\r\n        super(Individual());\r\n\r\n        this.Window_Width = settings['Window_Width'];\r\n        this.Window_Height = settings['Window_Height'];\r\n\r\n        this.x_pos = x_pos;\r\n        this.y_pos = y_pos;\r\n        this.y_speed = y_speed;\r\n            \r\n        // this.bird_surface = pygame.image.load(\"assets/bluebird-midflap.png\").convert_alpha();\r\n        // this.bird_surface = pygame.transform.scale2x(self.bird_surface);\r\n        // this.bird_rect = self.bird_surface.get_rect(center = (self.x_pos, self.y_pos));\r\n        this.bird_sprite = p5.loadImage(bluebird_sprite);\r\n        this.champbird_sprite = p5.loadImage(redbird_sprite);\r\n        this.winnerbird_sprite = p5.loadImage(yellowbird_sprite);\r\n        // this.bird_surface = pygame.transform.scale2x(self.bird_surface);\r\n        // this.bird_rect = self.bird_surface.get_rect(center = (self.x_pos, self.y_pos));\r\n\r\n        this.fitness = 0;  // Overall fitness\r\n        this.score = 0;\r\n        this.x_distance_to_next_pipe_center = 0;\r\n        this.y_distance_to_next_pipe_center = 0;\r\n        this.is_alive = true;\r\n\r\n        this.hidden_layer_architecture = hidden_layer_architecture;\r\n        this.hidden_activation = hidden_activation;\r\n        this.output_activation = output_activation;\r\n\r\n\r\n\r\n        // Setting up network architecture\r\n        const num_inputs = 5 //@TODO: how many\r\n        this.network_architecture = [num_inputs]                          // Inputs\r\n        this.network_architecture.push(...this.hidden_layer_architecture)  // Hidden layers\r\n        this.network_architecture.push(2)                               // 2 output, jump or not jump\r\n        this.network = new FeedForwardNetwork(this.network_architecture,\r\n                                          get_activation_by_name(this.hidden_activation),\r\n                                          get_activation_by_name(this.output_activation)\r\n        )\r\n\r\n        // If chromosome is set, take it\r\n        if (chromosome) {\r\n            // self._chromosome = chromosome\r\n            this.network.params = chromosome\r\n            // self.decode_chromosome()\r\n        } \r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    fitness = () => {\r\n        return this.fitness\r\n    }\r\n\r\n    bird_top = () => {\r\n        return this.y_pos - this.bird_sprite.height / 2\r\n    }\r\n    bird_bottom = () => {\r\n        return this.y_pos + this.bird_sprite.height / 2\r\n    }\r\n    bird_left = () => {\r\n        return this.x_pos - this.bird_sprite.width / 2\r\n    }\r\n    bird_right = () => {\r\n        return this.x_pos + this.bird_sprite.width / 2\r\n    }\r\n\r\n    \r\n    calculate_fitness = () => {\r\n        // # Give positive minimum fitness for roulette wheel selection\r\n        // # self._fitness = (self._frames) + ((2**self.score) + (self.score**2.1)*500) - (((.25 * self._frames)**1.3) * (self.score**1.2))\r\n        // # self._fitness = (self._frames) + ((2**self.score) + (self.score**2.1)*500) - (((.25 * self._frames)) * (self.score))\r\n        // print(self.y_distance_to_next_pipe_center)\r\n        this.fitness = (2 ** this.score + this.score * 2.1) * 200 + 1000 - this.x_distance_to_next_pipe_center - Math.abs(this.y_distance_to_next_pipe_center) * 20\r\n        this.fitness = Math.max(this.fitness, .1)\r\n    }\r\n\r\n    // def chromosome(self):\r\n    //     # return self._chromosome\r\n    //     pass\r\n\r\n    // def encode_chromosome(self):\r\n    //     # # L = len(self.network.params) // 2\r\n    //     # L = len(self.network.layer_nodes)\r\n    //     # # Encode weights and bias\r\n    //     # for layer in range(1, L):\r\n    //     #     l = str(layer)\r\n    //     #     self._chromosome['W' + l] = self.network.params['W' + l].flatten()\r\n    //     #     self._chromosome['b' + l] = self.network.params['b' + l].flatten()\r\n    //     pass\r\n\r\n    // def decode_chromosome(self):\r\n    //     # # L = len(self.network.params) // 2\r\n    //     # L = len(self.network.layer_nodes)\r\n    //     # # Decode weights and bias\r\n    //     # for layer in range(1, L):\r\n    //     #     l = str(layer)\r\n    //     #     w_shape = (self.network_architecture[layer], self.network_architecture[layer-1])\r\n    //     #     b_shape = (self.network_architecture[layer], 1)\r\n    //     #     self.network.params['W' + l] = self._chromosome['W' + l].reshape(w_shape)\r\n    //     #     self.network.params['b' + l] = self._chromosome['b' + l].reshape(b_shape)\r\n    //     pass\r\n\r\n    // restart the game for this individual\r\n    reset= () => {\r\n        this.fitness = 0\r\n        this.score = 0\r\n        this.x_distance_to_next_pipe_center = 0\r\n        this.y_distance_to_next_pipe_center = 0\r\n        this.x_pos = settings['init_bird_x_pos']\r\n        this.y_pos = settings['init_bird_y_pos']\r\n        this.y_speed = 0\r\n        this.is_alive = true \r\n    }\r\n\r\n    update = (inputs=null) => {\r\n        this.network.feed_forward(inputs)\r\n        if (this.network.out == 1) {\r\n            // jump\r\n            this.y_speed = settings['bird_jump_speed']\r\n        }\r\n        // console.log(this.is_alive)\r\n        return true\r\n    }\r\n\r\n    move = (pipes) => {\r\n        this.y_pos += this.y_speed\r\n        this.y_speed += settings['gravity']\r\n        // this.score += 1/1.2/60\r\n        \r\n        this.score += 1 / (settings['pipe_interval_in_pixels'] / 5)\r\n\r\n        this.check_collision(pipes)\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n    // ################################################################################################################\r\n    // TODO: makes pipe class and make the pipe.collide()\r\n    check_collision = (pipes) => {\r\n        for (var pipe of pipes) {\r\n            // if (this.bird_rect.colliderect(pipe)) {\r\n            if (pipe.collide(this.x_pos, this.y_pos, this.bird_sprite)) {\r\n                // console.log(\"collision detected with pipe\")\r\n                this.is_alive = false \r\n            }\r\n        }\r\n        if (this.bird_top() <= 0 || this.bird_bottom() >= this.Window_Height - 50) {\r\n            // console.log(\"*****************************collision detected with floor/ceiling\")\r\n            this.is_alive = false \r\n        }\r\n        // if (this.y_pos <= 0 || this.y_pos >= this.Window_Height - 50) {\r\n        //     console.log(this.y_pos, this.bird_top, this.bird_bottom)\r\n        //     console.log(\"*****************************collision detected with floor/ceiling\")\r\n        //     this.is_alive = false \r\n        // }\r\n    }\r\n    \r\n\r\n\r\n\r\n\r\n   \r\n    // rotate_bird = (bird_surface) => {\r\n    //     new_bird = pygame.transform.rotozoom(bird_surface, self.y_speed * -3, 1)\r\n    //     return new_bird\r\n    // }\r\n\r\n\r\n\r\n    // ################################################################################################################\r\n    // TODO: what to do with the surfaces without pygame\r\n    // # Draw the bird\r\n    draw = (p5, winner=false, champion=false) => {\r\n        if (!this.is_alive) {\r\n            return\r\n        } \r\n\r\n        p5.push()\r\n        p5.translate(this.x_pos, this.y_pos);\r\n        p5.rotate(this.y_speed / 20)\r\n        if (champion) {\r\n            p5.image(this.champbird_sprite, -this.champbird_sprite.width / 2, -this.champbird_sprite.height / 2)\r\n        } else if (winner) {\r\n            p5.image(this.winnerbird_sprite, -this.winnerbird_sprite.width / 2, -this.winnerbird_sprite.height / 2)\r\n        } else {\r\n            p5.image(this.bird_sprite, -this.bird_sprite.width / 2, -this.bird_sprite.height / 2)\r\n        }\r\n        p5.pop()\r\n    }\r\n}\r\n\r\n\r\nexport default Bird;\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n","import settings from './settings';\n\nconst random = require('random');\n\nclass Pipe {\n    // (x,y) is the coordinate of the midtop or midbottom of the pipe, depending on if the pipe is at top or bottom\n    constructor(isBottom, x, y, height, width) {\n        this.isBottom = isBottom\n        this.x = x\n        this.y = y\n        this.height = height\n        this.width = width\n    }\n\n    right_x = () => {\n        return this.x + this.width / 2\n    }\n\n    left_x = () => {\n        // console.log(\"left_x = () => {\")\n        // console.log(this.x)\n        // console.log(this.width)\n        return this.x - this.width / 2\n    }\n\n    top_or_bottom_y = () => {\n        return this.y\n    }\n\n    top_y = () => {\n        if (this.isBottom) \n            return this.y\n        return this.y - this.height\n    }\n\n    bottom_y = () => {\n        if (this.isBottom) \n            return this.y + this.height\n        return this.y \n    }\n\n    move = () => {\n        this.x -= 5\n    }\n    \n    collide = (x_pos, y_pos, target_sprite) => {\n        const target_hwidth = target_sprite.width / 2 \n        const target_hheight = target_sprite.height / 2\n        if (x_pos >= this.left_x()-target_hwidth \n            && x_pos <= this.right_x()+target_hwidth \n            && y_pos >= this.top_y()-target_hheight \n            && y_pos <= this.bottom_y()+target_hheight) {\n            // (x_pos,y_pos) is within the pipe with added padding of half of the width and height of the target_sprite on all 4 sides --> collision\n            return true\n        }\n        return false\n    }\n\n    draw = (p5, pipe_sprite) => {\n        p5.push()\n        // translate(this.x_pos - this.size / 2 - 8 + birdSprite.width / 2, this.y_pos - this.size / 2 + birdSprite.height / 2);\n\n        if (!this.isBottom) {\n            p5.translate(this.left_x() + pipe_sprite.width, this.bottom_y());\n            p5.rotate(Math.PI)\n        } else {\n            p5.translate(this.left_x(), this.top_y());\n        }\n        // p5.image(pipe_sprite, -pipe_sprite.width / 2, -pipe_sprite.height / 2)\n        p5.image(pipe_sprite, 0, 0)\n\n        // p5.image(pipe_sprite, 100, 100, 100, 100)\n        p5.pop()\n    }\n\n    static create_pipe_pair = (Window_Width, height, width) => {\n        // random_pipe_pos = random.choice([400, 500, 600, 700, 800])\n        const random_pipe_pos = Math.floor(Math.random()*5)*25 + 120\n\n\n        const bottom_pipe = new Pipe(true, Window_Width + settings['pipe_interval_in_pixels'], random_pipe_pos, height, width)\n        const top_pipe = new Pipe(false, Window_Width + settings['pipe_interval_in_pixels'], random_pipe_pos - 100, height, width)\n        console.log(\"Generating new pipe pair\")\n        console.log([bottom_pipe, top_pipe])\n        return [bottom_pipe, top_pipe]\n\n\n        // const bottom_pipe = new Pipe(true, Window_Width + 200, 200, height, width)\n        // const top_pipe = new Pipe(false, Window_Width + 200, 100, height, width)\n        // console.log(\"Generating new pipe pair\")\n        // console.log(bottom_pipe.x, bottom_pipe.y, bottom_pipe.left_x(), bottom_pipe.top_y())\n        // console.log(top_pipe.x, top_pipe.y, top_pipe.left_x(), top_pipe.bottom_y())\n        // return [bottom_pipe, top_pipe]\n\n    }\n}\n\nexport default Pipe;","import React from 'react';\r\nimport Sketch from 'react-p5';\r\nimport Bird from './Bird';\r\nimport Pipe from './Pipe';\r\nimport settings from './settings';\r\nimport Population from '../genetic_algorithm/population';\r\nimport {FeedForwardNetwork, sigmoid, linear, relu} from './neural_network'\r\nimport {elitism_selection, roulette_wheel_selection} from '../genetic_algorithm/selection';\r\nimport {gaussian_mutation, random_uniform_mutation} from '../genetic_algorithm/mutation';\r\nimport {simulated_binary_crossover as SBX} from '../genetic_algorithm/crossover';\r\nimport {uniform_binary_crossover, single_point_binary_crossover} from '../genetic_algorithm/crossover';\r\nimport { image } from '@tensorflow/tfjs';\r\n\r\n// import background_sprite_import from \"./assets/background-day.png\"\r\nimport background_sprite_import from \"./assets/background-day_horizontal.png\"\r\nimport base_sprite_imoprt from \"./assets/base.png\"\r\nimport pipe_sprite_import from \"./assets/pipe-green.png\"\r\n\r\nconst random = require('random');\r\nvar nj = require('@aas395/numjs');\r\n\r\n\r\nfunction Flappy(props) {\r\n    const cumulativeSum = (sum => value => sum += value)(0);\r\n    var _mutation_bins = [settings['probability_gaussian'], settings['probability_random_uniform']].map(cumulativeSum);\r\n    var _crossover_bins = [settings['probability_SBX'], settings['probability_SPBX']].map(cumulativeSum);\r\n    var _SPBX_type = settings['SPBX_type'].toLowerCase();\r\n    var _SBX_eta = settings['SBX_eta'];\r\n    var _mutation_rate = settings['mutation_rate'];\r\n\r\n    // Determine size of next gen based off selection type\r\n    var _next_gen_size = null;\r\n    if (settings['selection_type'].toLowerCase() == 'plus')\r\n        _next_gen_size = settings['num_parents'] + settings['num_offspring'];\r\n    else if (settings['selection_type'].lower() == 'comma')\r\n        _next_gen_size = settings['num_offspring'];\r\n    else\r\n        throw new Error('Selection type \"{}\" is invalid'.format(settings['selection_type']));\r\n\r\n    var board_size = props.dimension;\r\n    // console.log(board_size)\r\n    // var Window_Width = settings['Window_Width']\r\n    // var Window_Height = settings['Window_Height']\r\n    var Window_Width = props.dimension[0]   \r\n    var Window_Height = props.dimension[1]  \r\n    console.log(Window_Width, Window_Height)        //493  295\r\n\r\n    var individuals = [];\r\n\r\n    var population = new Population(individuals);\r\n    var current_generation = 0;\r\n    var winner = null;\r\n    var winner_index = -1;\r\n    var champion = null;\r\n    var champion_index = -1;\r\n    var champion_fitness = Number.NEGATIVE_INFINITY;\r\n\r\n\r\n\r\n    // game params\r\n\r\n    // load assets\r\n    var bg_sprite = null\r\n\r\n    var floor_sprite = null\r\n    var floor_x = 0\r\n\r\n    var pipe_sprite = null\r\n    var pipe_list = []\r\n    \r\n    \r\n    var spawn_pipe_counter = 0\r\n\r\n\r\n    // scores\r\n    var score = 0\r\n    var high_score = 0\r\n\r\n\r\n    const setup = (p5, canvasParentRef) => {\r\n        // use parent to render the canvas in this ref\r\n        // (without that p5 will render the canvas outside of your component)\r\n        console.log('=================Flappy setup==========================');\r\n        console.log('=================Flappy setup==========================');\r\n        console.log('=================Flappy setup==========================');\r\n\r\n        bg_sprite = p5.loadImage(background_sprite_import)\r\n        floor_sprite = p5.loadImage(base_sprite_imoprt)\r\n        pipe_sprite = p5.loadImage(pipe_sprite_import)\r\n\r\n\r\n        // var temp = Pipe.create_pipe_pair(Window_Width, pipe_sprite.height, pipe_sprite.width)\r\n        // pipe_list.push(temp[0])\r\n        // pipe_list.push(temp[1])\r\n        // pipe_list.push(...Pipe.create_pipe_pair(Window_Width, pipe_sprite.height, pipe_sprite.width))\r\n        // pipe_list.push.apply(Pipe.create_pipe_pair(Window_Width))\r\n        \r\n        console.log(pipe_list)\r\n\r\n        \r\n\r\n\r\n\r\n        p5.createCanvas(board_size[0], board_size[1]).parent(canvasParentRef);\r\n        for (var i=0; i < settings['num_parents']; i++) {\r\n            // const individual = new Bird(p5=p5, \r\n            //                         hidden_layer_architecture=settings['hidden_network_architecture'],\r\n            //                         hidden_activation=settings['hidden_layer_activation'],\r\n            //                         output_activation=settings['output_layer_activation']);\r\n            const individual = new Bird(p5, \r\n                                        null,\r\n                                        settings['hidden_network_architecture'],\r\n                                        settings['hidden_layer_activation'],\r\n                                        settings['output_layer_activation'],\r\n                                        settings['init_bird_x_pos'],\r\n                                        settings['init_bird_y_pos'],\r\n                                        0);\r\n            individuals.push(individual);\r\n        }\r\n\r\n        const button = p5.createButton('Return').parent(canvasParentRef);\r\n        button.position(30, 10);\r\n        button.style('background-color', '#8A2BE2')\r\n        button.mousePressed(props.updateStart);\r\n    };\r\n\r\n    \r\n    const draw = (p5) => {\r\n        p5.background(99);\r\n        // p5.push()\r\n        // p5.fill('#00ff00');\r\n        // p5.rect(10, 10, 15, 90);\r\n        // p5.pop()\r\n        \r\n        p5.push()\r\n        p5.scale(1.75)\r\n        p5.image(bg_sprite, 0, 0, Window_Width);\r\n        p5.pop()\r\n\r\n        // # Pipes\r\n        spawn_pipe_counter += 1\r\n        \r\n        \r\n        // if (spawn_pipe_counter % settings['pipe_interval_in_frames'] == 0) {\r\n        //     pipe_list.push(...Pipe.create_pipe_pair(Window_Width, pipe_sprite.height, pipe_sprite.width))\r\n        // }\r\n\r\n        if (pipe_list.length <= 1 || pipe_list[pipe_list.length - 1].x <= Window_Width) {\r\n            pipe_list.push(...Pipe.create_pipe_pair(Window_Width, pipe_sprite.height, pipe_sprite.width))\r\n        }\r\n\r\n\r\n        pipe_list = move_pipes(pipe_list)\r\n        draw_pipes(p5, pipe_list) \r\n        \r\n        // # Floor\r\n        floor_x = (floor_x - 6) % - Window_Width\r\n        draw_floor(p5)\r\n\r\n        // # TODO: should change this for better visibility\r\n        p5.push()\r\n        p5.textSize(14)\r\n        p5.text('Generation: ' + Math.floor(current_generation), Window_Width - 150, 30)\r\n        p5.text('Score: ' + Math.floor(Math.max(score-1.2, 0)), Window_Width - 150, 60)\r\n        p5.text('Best: ' + Math.floor(Math.max(high_score-1.2, 0)), Window_Width - 150, 90)\r\n        // p5.text('Score: ' + Math.max(score-1.7, 0), Window_Width - 150, 60)\r\n        // p5.text('Best: ' + Math.max(high_score-1.7, 0), Window_Width - 150, 90)\r\n        p5.pop()\r\n\r\n\r\n\r\n        var still_alive = 0;\r\n        // Loop through the birds in the generation\r\n        for (var i=0; i < population.individuals.length; i++) {\r\n            var bird = population.individuals[i];\r\n\r\n            if (bird.is_alive) {\r\n                still_alive++;\r\n                // console.log(bird.y_pos, bird.x_pos)\r\n                //----------------------------------------inputs for neural network--------------------------------------------\r\n\r\n                var next_pipe = get_next_pipe(false)\r\n                var next_next_pipe = get_next_pipe(true)\r\n                \r\n                bird.x_distance_to_next_pipe_center = next_pipe.right_x() - settings['init_bird_x_pos']\r\n                bird.y_distance_to_next_pipe_center = (next_pipe.top_or_bottom_y() - 50) - bird.y_pos\r\n                if (next_next_pipe != null) {\r\n                    bird.x_distance_to_next_next_pipe_center = next_next_pipe.right_x() - settings['init_bird_x_pos']\r\n                    bird.y_distance_to_next_next_pipe_center = (next_next_pipe.top_or_bottom_y() - 50) - bird.y_pos\r\n                } else {\r\n                    bird.x_distance_to_next_next_pipe_center = 0\r\n                    bird.y_distance_to_next_next_pipe_center = 0\r\n                }\r\n                const inputs = [[bird.y_speed], [bird.y_pos], [bird.x_distance_to_next_pipe_center], [bird.y_distance_to_next_pipe_center], [bird.y_distance_to_next_next_pipe_center]]\r\n                //----------------------------------------inputs for neural network--------------------------------------------\r\n\r\n                bird.update(inputs)\r\n                bird.move(pipe_list)\r\n                score = Math.max(score, bird.score)\r\n                high_score = Math.max(score, high_score)\r\n            }\r\n\r\n\r\n            // Draw every paddle except the best ones\r\n            if (bird.is_alive && bird !== winner && bird !== champion) {\r\n                bird.draw(p5)\r\n            }\r\n        }\r\n        // Generate new generation when all have died out\r\n        // console.log(still_alive)\r\n        if (still_alive === 0){\r\n            // console.log('============================================================= pre NEW Generation =============================================================');\r\n            next_generation(p5);\r\n        }\r\n\r\n        // Draw the winning and champion paddle last\r\n        if (winner !== null && winner.is_alive) {\r\n            winner.draw(p5, true, false);\r\n        }\r\n        if (champion !== null && champion.is_alive) {\r\n            champion.draw(p5, false, true);\r\n        }\r\n\r\n        // Limit to 60 frames per second\r\n        p5.frameRate(60)\r\n    };\r\n\r\n    const draw_floor = (p5) => {\r\n        p5.push()\r\n        p5.image(floor_sprite, floor_x, Window_Height - 50) \r\n        p5.image(floor_sprite, floor_x + floor_sprite.width, Window_Height - 50) \r\n        p5.image(floor_sprite, floor_x + floor_sprite.width * 2, Window_Height - 50)\r\n        p5.image(floor_sprite, floor_x + floor_sprite.width * 3, Window_Height - 50) \r\n        p5.pop()\r\n    }\r\n\r\n    const move_pipes = (pipes) => {\r\n        for (var pipe of pipes)\r\n            pipe.move()\r\n        return pipes\r\n    }\r\n\r\n    const draw_pipes = (p5, pipes) => {\r\n        for (var pipe of pipes)\r\n            pipe.draw(p5, pipe_sprite)\r\n    }\r\n\r\n    const get_next_pipe = (nextnext) => {\r\n        var next_pipe = null\r\n        var next_next_pipe = null\r\n        // console.log(\"===get_next_pipe===\")\r\n        // console.log(pipe_list)\r\n        for (var pipe of pipe_list) {\r\n            // console.log(pipe.right_x())\r\n            // console.log(settings['init_bird_x_pos'])\r\n            if (pipe.right_x() > settings['init_bird_x_pos'] && next_pipe == null)\r\n                next_pipe = pipe\r\n            else if (next_pipe != null && next_next_pipe == null) \r\n                next_next_pipe = pipe\r\n        }\r\n        // console.log(next_pipe)\r\n        // console.log(next_next_pipe)\r\n        if (nextnext)\r\n            return next_next_pipe\r\n        return next_pipe\r\n    }\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n\r\n    // #### GA Related ####\r\n\r\n    const next_generation = (p5) => {\r\n        // console.log('============================================================= NEW Generation =============================================================');\r\n        current_generation++;\r\n        score = 0\r\n        pipe_list.length = 0            // clear the array to []\r\n        pipe_list.push.apply(Pipe.create_pipe_pair(Window_Width, pipe_sprite.height, pipe_sprite.width))\r\n        spawn_pipe_counter = 0\r\n        \r\n        // Calculate fitness of individuals\r\n        for (var individual of population.individuals)\r\n            individual.calculate_fitness();\r\n        \r\n        // Find winner from each generation and champion\r\n        winner = population.fittest_individual();\r\n        winner_index = population.individuals.indexOf(winner);\r\n        if (winner.fitness > champion_fitness) {\r\n            champion_fitness = winner.fitness;\r\n            champion = winner;\r\n            champion_index = winner_index;\r\n        }\r\n        winner.reset();\r\n        champion.reset();\r\n\r\n        // Print results from each generation\r\n        console.log('======================= Generation', current_generation, '=======================');\r\n        console.log('----Max fitness:', population.fittest_individual().fitness);\r\n        // print('----Best Score:', self.population.fittest_individual.score);\r\n        console.log('----Average fitness:', population.average_fitness());\r\n\r\n        props.addAvgFitness(population.average_fitness());\r\n        props.addMaxFitness(population.fittest_individual().fitness);\r\n        \r\n        population.individuals = elitism_selection(population, settings['num_parents']);\r\n        population.individuals = shuffle(population.individuals);\r\n        var next_pop = [];\r\n\r\n        // parents + offspring selection type ('plus')\r\n        if (settings['selection_type'].toLowerCase() === 'plus') {\r\n            next_pop.push(winner);\r\n            next_pop.push(champion);\r\n        }\r\n\r\n        while (next_pop.length < _next_gen_size) {\r\n            var [p1, p2] = roulette_wheel_selection(population, 2);\r\n            const L = p1.network.layer_nodes.length;\r\n            var c1_params = {};\r\n            var c2_params = {};\r\n\r\n            // Each W_l and b_l are treated as their own chromosome.\r\n            // Because of this I need to perform crossover/mutation on each chromosome between parents\r\n            for (var l = 1; l < L; l++) {\r\n                const p1_W_l = p1.network.params['W' + l.toString()]\r\n                const p2_W_l = p2.network.params['W' + l.toString()]  \r\n                const p1_b_l = p1.network.params['b' + l.toString()]\r\n                const p2_b_l = p2.network.params['b' + l.toString()]\r\n\r\n                var c1_W_l = null, c2_W_l = null, c1_b_l = null, c2_b_l = null;\r\n\r\n                // Crossover\r\n                // @NOTE: I am choosing to perform the same type of crossover on the weights and the bias.\r\n                [c1_W_l, c2_W_l, c1_b_l, c2_b_l] = _crossover(p1_W_l, p2_W_l, p1_b_l, p2_b_l);\r\n\r\n                // Mutation\r\n                // @NOTE: I am choosing to perform the same type of mutation on the weights and the bias.\r\n                _mutation(c1_W_l, c2_W_l, c1_b_l, c2_b_l);\r\n\r\n                // Assign children from crossover/mutation\r\n                c1_params['W' + l.toString()] = c1_W_l;\r\n                c2_params['W' + l.toString()] = c2_W_l;\r\n                c1_params['b' + l.toString()] = c1_b_l;\r\n                c2_params['b' + l.toString()] = c2_b_l;\r\n\r\n                // Clip to [-1, 1]\r\n                for (var i=0; i<c1_params['W'+l.toString()].shape[0]; i++) {\r\n                    for (var j=0; j<c1_params['W'+l.toString()].shape[1]; j++) {\r\n                        c1_params['W'+l.toString()].set(i, j, c1_params['W'+l.toString()].get(i, j) < -1 ? -1 : c1_params['W'+l.toString()].get(i, j));\r\n                        c1_params['W'+l.toString()].set(i, j, c1_params['W'+l.toString()].get(i, j) > 1 ? 1 : c1_params['W'+l.toString()].get(i, j));\r\n                        c2_params['W'+l.toString()].set(i, j, c2_params['W'+l.toString()].get(i, j) < -1 ? -1 : c2_params['W'+l.toString()].get(i, j));\r\n                        c2_params['W'+l.toString()].set(i, j, c2_params['W'+l.toString()].get(i, j) > 1 ? 1 : c2_params['W'+l.toString()].get(i, j));\r\n                        c1_params['b'+l.toString()].set(i, j, c1_params['b'+l.toString()].get(i, j) < -1 ? -1 : c1_params['b'+l.toString()].get(i, j));\r\n                        c1_params['b'+l.toString()].set(i, j, c1_params['b'+l.toString()].get(i, j) > 1 ? 1 : c1_params['b'+l.toString()].get(i, j));\r\n                        c2_params['b'+l.toString()].set(i, j, c2_params['b'+l.toString()].get(i, j) < -1 ? -1 : c2_params['b'+l.toString()].get(i, j));\r\n                        c2_params['b'+l.toString()].set(i, j, c2_params['b'+l.toString()].get(i, j) > 1 ? 1 : c2_params['b'+l.toString()].get(i, j));\r\n                    }\r\n                }\r\n            }\r\n\r\n\r\n            // Create children from chromosomes generated above\r\n            var c1 = new Bird(p5, \r\n                            c1_params,\r\n                            settings['hidden_network_architecture'],\r\n                            settings['hidden_layer_activation'],\r\n                            settings['output_layer_activation'],\r\n                            settings['init_bird_x_pos'],\r\n                            settings['init_bird_y_pos'],\r\n                            0);\r\n            var c2 = new Bird(p5, \r\n                            c2_params,\r\n                            settings['hidden_network_architecture'],\r\n                            settings['hidden_layer_activation'],\r\n                            settings['output_layer_activation'],\r\n                            settings['init_bird_x_pos'],\r\n                            settings['init_bird_y_pos'],\r\n                            0);\r\n\r\n            // Add children to the next generation\r\n            next_pop.push(...[c1,c2]);\r\n        }\r\n        shuffle(next_pop);\r\n        population.individuals = next_pop;\r\n        \r\n    }\r\n\r\n    const _crossover = (parent1_weights, parent2_weights, parent1_bias, parent2_bias) => {\r\n        const rand_crossover = random.float();\r\n        var crossover_bucket = null;\r\n        for (var i = 1; i < _crossover_bins.length; i++) {\r\n            if (rand_crossover < _crossover_bins[i])\r\n                crossover_bucket = i-1;\r\n        }\r\n        var child1_weights = null;\r\n        var child2_weights = null;\r\n        var child1_bias = null;\r\n        var child2_bias = null;\r\n\r\n        // SBX\r\n        if (crossover_bucket === 0) {\r\n            [child1_weights, child2_weights] =  SBX(parent1_weights, parent2_weights, _SBX_eta);\r\n            [child1_bias, child2_bias] = SBX(parent1_bias, parent2_bias, _SBX_eta);\r\n        }\r\n\r\n        // Single point binary crossover (SPBX)\r\n        else if (crossover_bucket === 1) {\r\n            [child1_weights, child2_weights] = single_point_binary_crossover(parent1_weights, parent2_weights, _SPBX_type);\r\n            [child1_bias, child2_bias] =  single_point_binary_crossover(parent1_bias, parent2_bias, _SPBX_type);\r\n        }\r\n\r\n        else\r\n            throw new Error('Unable to determine valid crossover based off probabilities');\r\n        \r\n        return [child1_weights, child2_weights, child1_bias, child2_bias];\r\n    }\r\n\r\n    const _mutation = (child1_weights, child2_weights, child1_bias, child2_bias) => {\r\n        const scale = 0.2;\r\n        const rand_mutation = random.float();\r\n        var mutation_bucket = null;\r\n        for (var i = 1; i < _mutation_bins.length; i++) {\r\n            if (rand_mutation < _mutation_bins[i])\r\n                mutation_bucket = i-1;\r\n        }\r\n\r\n        var mutation_rate = _mutation_rate;\r\n        if (settings['mutation_rate_type'].toLowerCase() === 'decaying')\r\n            mutation_rate = mutation_rate / Math.sqrt(current_generation + 1);\r\n        \r\n        if (mutation_bucket === 0) {\r\n            // Mutate weights\r\n            gaussian_mutation(child1_weights, mutation_rate, scale);\r\n            gaussian_mutation(child2_weights, mutation_rate, scale);\r\n\r\n            // Mutate bias\r\n            gaussian_mutation(child1_bias, mutation_rate, scale);\r\n            gaussian_mutation(child2_bias, mutation_rate, scale);\r\n        }\r\n        \r\n        // Uniform random\r\n        else if (mutation_bucket === 1) {\r\n            // Mutate weights\r\n            random_uniform_mutation(child1_weights, mutation_rate, -1, 1);\r\n            random_uniform_mutation(child2_weights, mutation_rate, -1, 1);\r\n\r\n            // Mutate bias\r\n            random_uniform_mutation(child1_bias, mutation_rate, -1, 1);\r\n            random_uniform_mutation(child2_bias, mutation_rate, -1, 1);\r\n        }\r\n\r\n        else\r\n            throw new Error('Unable to determine valid mutation based off probabilities.');\r\n    }\r\n\r\n    const shuffle = array => {\r\n        var currentIndex = array.length, temporaryValue, randomIndex;\r\n      \r\n        // While there remain elements to shuffle...\r\n        while (0 !== currentIndex) {\r\n      \r\n          // Pick a remaining element...\r\n          randomIndex = Math.floor(Math.random() * currentIndex);\r\n          currentIndex -= 1;\r\n      \r\n          // And swap it with the current element.\r\n          temporaryValue = array[currentIndex];\r\n          array[currentIndex] = array[randomIndex];\r\n          array[randomIndex] = temporaryValue;\r\n        }\r\n      \r\n        return array;\r\n    }\r\n\r\n\r\n    return (\r\n        <div>\r\n            <Sketch setup={setup} draw={draw} />\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default React.memo(Flappy, (prevProps, nextProps) => {return true});","export default \"data:image/png;base64,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\"","export default \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAVAAAABwBAMAAAC6HTVoAAAABGdBTUEAALGPC/xhBQAAACBjSFJNAAB6JgAAgIQAAPoAAACA6AAAdTAAAOpgAAA6mAAAF3CculE8AAAAGFBMVEVUOEfk/Ytzvy6c5llVgCLXqEze2JX////FcUEnAAAAAWJLR0QHFmGI6wAAAAlwSFlzAAAOxAAADsQBlSsOGwAAAAd0SU1FB+MDDAACE+f6JbgAAACmSURBVHja7c5BCQIBAAVRK1jBClawghXsH0HYu7AHYefDm9Mc3+2mP3cfaQf6OHoelX8M2vH8/C1oyPPzp6BXG079EvRyw6kfgl5vOPU70IDh1O9AXyPtQN8j7UA/I4GC1gMFrQcKWg8UtB4oaD1Q0HqgoPVAQeuBgtYDBa0HCloPFLQeKGg9UNB6oKD1QEHrgYLWAwWtBwpaDxS0HihoPVDQejPQL4Py73DUmV51AAAAJXRFWHRkYXRlOmNyZWF0ZQAyMDE5LTAzLTExVDE4OjAyOjE5KzA2OjAw4So5wwAAACV0RVh0ZGF0ZTptb2RpZnkAMjAxOS0wMy0xMVQxODowMjoxOSswNjowMJB3gX8AAAAASUVORK5CYII=\"","export default \"data:image/png;base64,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\"","import React, { useRef, useEffect, useState, useLayoutEffect } from 'react';\nimport css from './Genetic.module.css';\nimport {\n    BrowserRouter as Router,\n    Switch,\n    Route,\n    Link\n} from \"react-router-dom\";\n\nimport GeneticParams from './GeneticParams';\nimport Plot from './Plot';\nimport Pong from '../games/pong/Pong';\nimport Snake from '../games/snake/genetic_algorithm/Snake';\nimport Flappy from '../games/flappy_bird/Flappy';\n\nfunction Genetic(props) {\n    const gameParentRef = useRef(null);\n    const plotParentRef = useRef(null);\n    const [gameScreenDimension, setGameScreenDimension] = useState({width: 0, height: 0});\n    const [plotScreenDimension, setPlotScreenDimension] = useState({width: 0, height: 0});\n    const [settings, setSettings] = useState({\n                                    'hiddenLayerArchitecture': null,\n                                    'mutationRate': null,\n                                    'mutationRateType': null,\n                                    'numParents': null,\n                                    'numOffsprings': null\n                                    })\n    const [start, setStart] = useState(false);\n    const [avgFitness, setAvgFitness] = useState([[0,1000]]);\n    const [maxFitness, setMaxFitness] = useState([[0,1000]]);\n\n    const addAvgFitness = (avgFitness_) => {\n        setAvgFitness(avgFitness => [...avgFitness, [avgFitness.length, avgFitness_]]);\n    } \n\n    const addMaxFitness = (maxFitness_) => {\n        setMaxFitness(maxFitness => [...maxFitness, [maxFitness.length, maxFitness_]]);\n    }\n\n    useEffect ( () => {\n        if (gameParentRef.current) {\n            setGameScreenDimension({\n                width: gameParentRef.current.offsetWidth,\n                height: gameParentRef.current.offsetHeight\n            });\n        }\n        if (plotParentRef.current) {\n            setPlotScreenDimension({\n                width: plotParentRef.current.offsetWidth,\n                height: plotParentRef.current.offsetHeight\n            });\n        }\n    }, [gameParentRef, plotParentRef]);\n\n    const updateSettings = (hiddenLayerArchitecture, \n                            mutationRate, \n                            mutationRateType,\n                            numParents,\n                            numOffsprings) => {\n        setSettings({'hiddenLayerArchitecture': hiddenLayerArchitecture,\n                    'mutationRate': mutationRate,\n                    'mutationRateType': mutationRateType,\n                    'numParents': numParents,\n                    'numOffsprings': numOffsprings})\n    }\n\n    const updateStart = () => {\n        setStart(!start);\n        setAvgFitness([]);\n        setMaxFitness([]);\n    }\n\n    return (\n        <Router basename={process.env.PUBLIC_URL}>\n            <div className={css.container}>\n                <h1 className={css.name} onClick={()=>{props.history.push(process.env.PUBLIC_URL+'/')}}>\n                    <Link to='/' className={css.text}>\n                        AlphaGame\n                    </Link>\n                </h1>\n                <div className={css.background}>\n                    <div className={css.gameScreen} ref={gameParentRef}>\n                        {\n                            !start ?\n                            <GeneticParams updateSettings={updateSettings} updateStart={updateStart}/>\n                            :\n                            <Switch>\n                                <Route path='/snake'>\n                                    {\n                                        gameScreenDimension.width === 0 ?\n                                        <div></div> : <Snake dimension={[gameScreenDimension.width, gameScreenDimension.height]}\n                                                            settings={settings}\n                                                            updateStart={updateStart}\n                                                            addAvgFitness={addAvgFitness}\n                                                            addMaxFitness={addMaxFitness}/>\n                                    }\n                                </Route>\n                                <Route path='/pong'>\n                                    {\n                                        gameScreenDimension.width === 0 ?\n                                        <div></div> : <Pong dimension={[gameScreenDimension.width, gameScreenDimension.height]}\n                                                            settings={settings}\n                                                            updateStart={updateStart}\n                                                            addAvgFitness={addAvgFitness}\n                                                            addMaxFitness={addMaxFitness}/>\n                                    }\n                                </Route>\n                                <Route path='/flappybird'>\n                                    {\n                                        gameScreenDimension.width === 0 ?\n                                        <div></div> : <Flappy dimension={[gameScreenDimension.width, gameScreenDimension.height]}\n                                                            settings={settings}\n                                                            updateStart={updateStart}\n                                                            addAvgFitness={addAvgFitness}\n                                                            addMaxFitness={addMaxFitness}/>\n                                    }\n                                </Route>\n                            </Switch>\n                        }\n                    </div>\n                    <div className={css.plotScreen} ref={plotParentRef}>\n                        {\n                            plotScreenDimension.width === 0 ?\n                            <div></div> : <Plot dimension={[plotScreenDimension.width, plotScreenDimension.height]}\n                                                avgFitness={avgFitness}\n                                                maxFitness={maxFitness}/>\n                        }   \n                    </div>\n                </div>\n            </div>\n            <footer>\n                Copyright  2020 AlphaGame | \n                <a href='https://github.com/Alexduanran/AlphaGame' target='_blank' style={{textDecoration: 'none', color:'white'}}> Github</a>\n            </footer>\n        </Router>\n    );\n}\n\nexport default Genetic;\n","export default __webpack_public_path__ + \"static/media/snake.c6bcedf4.png\";","export default \"data:image/png;base64,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\"","export default __webpack_public_path__ + \"static/media/flappybird.31b09d32.png\";","export default __webpack_public_path__ + \"static/media/home2_gif.f51dd1b0.gif\";","export default __webpack_public_path__ + \"static/media/snake_gif.61188676.gif\";","export default __webpack_public_path__ + \"static/media/pong_gif.34e92973.gif\";","export default __webpack_public_path__ + \"static/media/flappybird_gif.87071256.gif\";","import React, {useState} from 'react';\nimport css from './Home.module.css';\nimport Genetic from './Genetic'\nimport {\n    BrowserRouter as Router,\n    Switch,\n    Route,\n    Link\n} from \"react-router-dom\";\nimport { Swiper, SwiperSlide } from 'swiper/react';\nimport SwiperCore, { Pagination, Mousewheel, EffectCoverflow } from 'swiper';\nimport 'swiper/swiper.scss';\nimport 'swiper/components/navigation/navigation.scss';\nimport 'swiper/components/pagination/pagination.scss';\nimport 'swiper/components/scrollbar/scrollbar.scss';\nimport 'swiper/components/effect-coverflow/effect-coverflow.scss';\nimport snake_png from '../media/snake.png';\nimport pong_png from '../media/pong.png';\nimport flappybird_png from '../media/flappybird.png';\nimport home2_gif from '../media/home2_gif.gif';\nimport snake_gif from '../media/snake_gif.gif';\nimport pong_gif from '../media/pong_gif.gif';\nimport flappybird_gif from '../media/flappybird_gif.gif';\n\nfunction Home(props) {\n    const [background, setBackground] = useState(home2_gif);\n    const [swipeIndex, setSwipeIndex] = useState(0);\n\n    SwiperCore.use([EffectCoverflow, Pagination, Mousewheel]);\n\n    function GameSwiper() {\n        setBackground(home2_gif);\n        return (\n            <Swiper className={css.swiperContainer}\n                    effect='coverflow'\n                    spaceBetween={30}\n                    slidesPerView={3}\n                    dynamicBullets={true}\n                    mousewheel={true}\n                    pagination={{ clickable: true }}\n                    centeredSlides={true}\n                    loop={true}\n                    initialSlide={swipeIndex}\n                    >\n                <SwiperSlide>\n                    <Link to='/snake'>\n                        <div className={css.square} style={{backgroundImage:`url(${snake_png})`}} />    \n                    </Link>\n                </SwiperSlide>\n                <SwiperSlide>\n                    <Link to='/pong'> \n                        <div className={css.square} style={{backgroundImage:`url(${pong_png})`}} />\n                    </Link>\n                </SwiperSlide>\n                <SwiperSlide>\n                    <Link to='/flappybird'>\n                        <div className={css.square} style={{backgroundImage:`url(${flappybird_png})`}} />\n                    </Link>\n                </SwiperSlide>\n            </Swiper>\n        )\n    }\n\n    function GameModes(prop) {\n        var image = null;\n        if (prop.name === 'snake') {\n            setBackground(snake_gif);\n            setSwipeIndex(0);\n            image = snake_png;\n        }\n        else if (prop.name === 'pong') {\n            setBackground(pong_gif);\n            setSwipeIndex(1);\n            image = pong_png;\n        }\n        else if (prop.name === 'flappybird') {\n            setBackground(flappybird_gif);\n            setSwipeIndex(2);\n            image = flappybird_png;\n        }\n        return (\n            <div className={css.grid}>\n                <div className={css.smallpic} style={{backgroundImage:`url(${image})`}} />\n                <div className={css.smallsquare} onClick={()=>{console.log(process.env.PUBLIC_URL);props.history.push(process.env.PUBLIC_URL + '/' + prop.name + '/genetic')}} >\n                    <h1 className={css.mode}>\n                        Genetic\n                        Algorithm\n                    </h1>\n                </div>\n                <div className={css.smallsquare} onClick={()=>{props.history.push(process.env.PUBLIC_URL + '/' + prop.name + '/reinforcement')}} >\n                    <h1 className={css.mode}>\n                        Reinforce-\n                        ment\n                        Learning\n                    </h1>\n                </div>\n                <div className={css.smallsquare} onClick={()=>{props.history.push(process.env.PUBLIC_URL + '/' + prop.name + '/battle')}} >\n                    <h1 className={css.mode}>\n                        Human\n                        vs.\n                        AI\n                    </h1>\n                </div>\n            </div>\n        )\n    }\n\n    return (\n        <Router basename={process.env.PUBLIC_URL}>\n            <div className={css.container}>\n                <h1 className={css.name}>\n                    <Link to='/' className={css.text}>\n                        AlphaGame\n                    </Link>\n                </h1>\n                <div className={css.background}>\n                    <div className={css.screen} style={{backgroundImage:`url(${background})`}}>\n                        <Switch>\n                            <Route path='/snake' >\n                                <GameModes name={'snake'} />\n                            </Route>\n                            <Route path='/pong'>\n                                <GameModes name={'pong'} />\n                            </Route>\n                            <Route path='/flappybird'>\n                                <GameModes name={'flappybird'} />\n                            </Route>\n                            <Route path='/'>\n                                <GameSwiper className={css.swiper}/>\n                            </Route>\n                        </Switch>\n                    </div>\n                </div>\n            </div>\n            <footer>\n                Copyright  2020 AlphaGame | \n                <a href='https://github.com/Alexduanran/AlphaGame' target='_blank' style={{textDecoration: 'none', color:'white'}}> Github</a>\n            </footer>\n        </Router>\n    );\n    }\n\nexport default Home;\n","/*\n1. All coordinates are in actual coordinats\n2. (0,0) is at the TOP-LEFT corner\n*/\n\nimport * as util from \"./util\";\nimport {colorGrid, Rect} from \"./sprite\";\nimport \"react-p5\";\n\n\nexport class Snake {\n    // Snake object for snake game.\n    // Attributes:\n    // - length\n    // - x\n    // - y\n    // - color\n    // - direction\n    // - boxSize\n    // - body\n    direction = \"U\";\n    length = 1;\n    constructor(x, y, length, direction, boxSize, board_x, board_y) {\n        this.x = x;\n        this.y = y;\n        this.length = length;\n        this.direction = direction;\n\n        this.boxSize = boxSize;\n        this.board_x = board_x;\n        this.board_y = board_y;\n\n        this.body = [];\n        this.initialize();\n        this.head = this.body[0];\n    }\n\n    initialize() {\n        var k1 = 0; var k2 = 0;\n        if (this.direction == \"R\") k1 = -1;\n        if (this.direction == \"L\") k1 = 1;\n        if (this.direction == \"U\") k2 = 1;\n        if (this.direction == \"D\") k2 = -1;\n\n        for (var i = 0; i < this.length; i++){\n            var tempRect = new Rect(\n                this.x + k1*i * this.boxSize,\n                this.y + k2*i * this.boxSize,\n                this.boxSize, this.boxSize\n            );\n            this.body.push(tempRect);\n        }\n    }\n\n    // change direction\n    changeDirection(direction) {\n        // input: direction in [0, 1, 2, 3]\n        const DIRECTION = [\"U\", \"R\", \"D\", \"L\"];\n\n        const current = DIRECTION.indexOf(this.direction);\n        const opposite = (current + 2) % 4;\n\n        if (direction != opposite && direction != current) {\n            this.direction = DIRECTION[direction];\n        }\n    }\n\n    // move a step forward\n    addHead(collideWall=true) {\n        var k1 = 0; var k2 = 0;\n        if (this.direction == \"R\") k1 = 1;\n        if (this.direction == \"L\") k1 = -1;\n        if (this.direction == \"U\") k2 = -1;\n        if (this.direction == \"D\") k2 = 1;\n\n        if (!(collideWall)) {\n            this.x = (this.x + k1*this.boxSize) % this.board_x;\n            this.y = (this.y + k2*this.boxSize) % this.board_y;\n        } else {\n            this.x = (this.x + k1*this.boxSize);\n            this.y = (this.y + k2*this.boxSize);\n        }\n\n        var newHead = new Rect(\n            this.x, this.y,\n            this.boxSize, this.boxSize\n        );\n        this.body.unshift(newHead);\n        this.head = this.body[0];\n    }\n\n    deleteTail() {\n        return this.body.pop();\n    }\n\n    addTail(tail) {\n        this.body.push(tail);\n    }\n\n    collideWithBody() {\n        for (var i = 1; i < this.body.length; i++) {\n            var part = this.body[i];\n            if (this.head.collideRect(part)) {\n                return true\n            }\n        }\n        return false;\n    }\n\n    collideWithWall(extraWalls=null) {\n        // normal wall check\n        var wallRect = new Rect(0, 0, this.board_x, this.board_y);\n        if ( !(wallRect.contains([this.x, this.y])) ) {\n            return true;\n        }\n        // extra wall check\n        if (extraWalls == null) return false;\n\n        var bool = false;\n        extraWalls.forEach(part => {\n            if (this.head.collideRect(part)) {\n                bool = true;\n            }\n        });\n        return bool;\n    }\n\n    addHead_snakeTwo(max_width, max_height) {\n        return null;\n    }\n\n    draw(p5) {\n        p5.fill(\"#7ffc03\");\n        for (var i=0; i < this.body.length; i++) {\n            var rect = this.body[i];\n            p5.rect(rect.x, rect.y, this.boxSize, this.boxSize);\n        }\n    }\n}\n\n\nexport class Apple {\n    /*\n    Apple Object for the snake game.\n    Attributes:\n    - boxLength\n    - x\n    - y\n    */\n    constructor(boxLength, x, y, board_x, board_y) {\n        this.boxLength = boxLength;\n        this.x = x;\n        this.y = y;\n        this.board_x = board_x;\n        this.board_y = board_y;\n        this.rect = new Rect(this.x, this.y, this.boxLength, this.boxLength);\n    }\n\n    // avoid: list of (x,y) arrays\n    move(avoid=null) {\n      const avoidCompare = (a, b) => util.arrayEqual(a, b);\n      while (true) {\n          var rand_x = util.getRandInt(0, this.board_x, this.boxLength);\n          var rand_y = util.getRandInt(0, this.board_y, this.boxLength);\n          var inAvoid = util.arrayContains(avoid, [rand_x,rand_y], avoidCompare);\n          if (avoid == null || !(inAvoid)){\n              break;\n          }\n      }\n      // to do construct a more efficient random for large avoid.\n      this.rect = new Rect(rand_x, rand_y, this.boxLength, this.boxLength);\n      this.x = rand_x;\n      this.y = rand_y;\n    }\n\n    draw(p5) {\n        p5.fill('#ff0000');\n        p5.rect(this.x, this.y, this.boxLength, this.boxLength);\n        // p5.rect(0,0,50,50);\n    }\n}\n\n\n// export default {Dummy, Snake, Apple};","/*\n1. stateType:\n  - 0: boolean vector of size 12\n  - 1:\n2.\n*/\n\nimport * as tf from '@tensorflow/tfjs';\n// var tf = require(\"tensorflowjs\");\nimport {Snake, Apple} from \"./snakeClass\";\nimport {colorGrid, Rect} from \"./sprite\"\nimport {generateExtraWalls, getRandInt, arrayEqual, arrayContains, euclidean} from \"./util\";\n\n\nexport class snakeGame {\n    constructor(params) {\n        // defaults\n        this.FPS = 10;\n        this.snakeLength = 3;\n\n        this.collideWall = true;\n        this.collideBody = true;\n        this.extraWalls = null;\n\n        this.manual = true;\n\n        this.stateType = \"12bool\";\n        this.rewardType = \"eat-die-close-away\";\n        this.rewardValues = {\n            eat: 10, die: -100, closer: 1, away: -1\n        };\n\n        for (var key in params) {\n            // Game-side Attributes\n            if (key == \"collideWall\") this.collideWall = params[key];\n            if (key == \"collideBody\") this.collideBody = params[key];\n            if (key == \"extraWalls\") this.extraWalls = params[key];\n\n            if (key == \"FPS\") this.FPS = params[key];\n\n            // Train-side Attributes\n            if (key == \"stateType\") this.stateType = params[key];\n            if (key == \"rewardType\") this.rewardType = params[key];\n            if (key == \"rewardValues\") this.rewardValues = params[key];\n\n            // Game Elements\n            if (key == \"snakeLength\") this.snakeLength = params[key];\n            if (key == \"manual\") this.manual = params[key];\n        }\n\n        // Mandatory\n        this.dpr = 1;\n        this.gridSize = params[\"gridSize\"] * this.dpr;\n        this.width = params[\"width\"] * this.gridSize;\n        this.height = params[\"height\"] * this.gridSize;\n\n        this.extraWalls = generateExtraWalls(this.extraWalls, this.gridSize, true);\n\n        // initialize\n        this.timer = null;\n\n        this.snake = null;\n        this.apple = null;\n\n        this.done = 0;\n        this.score = 0;\n        this.best_score = 0;\n        this.key_pressed = 0;\n\n        this.reset();\n        // this.render(); // now move render() inside reset()\n\n        if (this.manual) {\n            // player mode\n            this.keyboard_events();\n            // this.manual_play();\n        }\n\n        // attributes to compute reward\n        this.last_snake = null;\n        this.last_apple = null;\n        this.rewardMeasures = {\n            eat: 0, closer: 0, away: 0\n        };\n    }\n\n    // STATICS\n    _direction(action){\n      const DIRECTION_ARR = [\"U\",\"R\",\"D\",\"L\"];\n      return DIRECTION_ARR[action];\n    }\n\n    _action(direction){\n      const DIRECTION_ARR = [\"U\",\"R\",\"D\",\"L\"];\n      return DIRECTION_ARR.indexOf(direction);\n    }\n\n    // state space\n    update_state() {\n        if (this.stateType == \"12bool\") {\n            return this.update_state_12bool();\n        }\n    }\n    \n    update_state_12bool() {\n        // return a js array\n        // update state from this.snake and this.apple\n        // called after this.snake and this.apple are updated\n        var new_state = Array(12).fill(0);\n\n        // Direction of Snake\n        if (this.snake.direction == \"U\") {\n            new_state[0] = 1;\n        } else if (this.snake.direction == \"R\") {\n            new_state[1] = 1;\n        } else if (this.snake.direction == \"D\") {\n            new_state[2] = 1;\n        } else if (this.snake.direction == \"L\") {\n            new_state[3] = 1;\n        }\n\n        // Apple position (wrt snake head)\n        // (0,0) at Top-Left Corner: U: -y; R: +x\n        if (this.apple.y < this.snake.y) {\n            // apple north snake\n            new_state[4] = 1\n        }\n        if (this.apple.x > this.snake.x) {\n            // apple east snake\n            new_state[5] = 1\n        }\n        if (this.apple.y > this.snake.y) {\n            // apple south snake\n            new_state[6] = 1\n        }\n        if (this.apple.x < this.snake.x) {\n            // apple west snake\n            new_state[7] = 1\n        }\n\n        // Obstacle (Walls, body) position (wrt snake head)\n        var test_snake;\n        const test_case = {\n            \"U\": {oppo: \"D\", x: 0, y: -this.gridSize, state: 8},\n            \"R\": {oppo: \"L\", x: this.gridSize, y: 0, state: 9},\n            \"D\": {oppo: \"U\", x: 0, y: this.gridSize, state: 10},\n            \"L\": {oppo: \"R\", x: -this.gridSize, y: 0, state: 11}\n        };\n        for (var key in test_case) {\n            var test = test_case[key];\n            if (this.snake.direction != test[\"oppo\"]) {\n                test_snake = new Snake(\n                    this.snake.x + test[\"x\"], this.snake.y + test[\"y\"], \n                    1, \"U\", this.gridSize, this.width, this.height\n                )\n                if (test_snake.collideWithWall(this.extraWalls)) {\n                    new_state[test[\"state\"]] = 1;\n                }\n            }\n        }\n        return tf.tensor2d(new_state, [1,12]);\n    }\n\n    // reward function\n    reward() {\n        if (this.rewardType == \"eat-die-close-away\") {\n            return this.reward_basic();\n        }\n    }\n\n    reward_basic() {\n        const value = this.rewardValues;\n        const check = this.rewardMeasures;\n\n        if (this.done) return value[\"die\"];\n        if (check[\"eat\"]) return value[\"eat\"];\n        if (check[\"closer\"]) return value[\"closer\"];\n        if (check[\"away\"]) return value[\"away\"];\n        return 0;\n    }\n\n    clear_reward() {\n        // reset reward_measures\n        for (var key in this.rewardMeasures) {\n            this.rewardMeasures[key] = 0;\n        }\n    }\n\n    // functions\n    reset() {\n        // return a js array\n        this.done = 0;\n        this.score = 0;\n\n        // initialize snake head\n        var rand_x, rand_y, avoid, inAvoid;\n        const avoidCompare = (a, b) => arrayEqual(a, b);\n        if (this.extraWalls == null) {\n            avoid = null;\n        } else {\n            avoid = this.extraWalls.map(rect => [rect.x, rect.y]);\n        }\n        while (true) {\n            rand_x = getRandInt(5*this.gridSize, this.width-5*this.gridSize, this.gridSize);\n            rand_y = getRandInt(5*this.gridSize, this.width-5*this.gridSize, this.gridSize);\n            inAvoid = arrayContains(avoid, [rand_x,rand_y], avoidCompare);\n            console.log(inAvoid);\n            if (avoid == null || !(inAvoid)){\n                break;\n            }\n        }\n\n        this.snake = new Snake(\n            rand_x, rand_y,\n            this.snakeLength, this._direction(getRandInt(0,4)), this.gridSize,\n            this.width, this.height\n        );\n\n        this.apple = new Apple(this.gridSize, 0, 0, this.width, this.height);\n        this.move_apple();\n\n        // this.render()\n\n        // restart moving\n        if (this.manual) {\n            clearInterval(this.timer);\n            this.manual_play();\n        }\n        \n        // add update_state if used for training\n        return this.update_state();\n    }\n\n    move_apple() {\n        var avoid = this.snake.body.map(part => [part.x, part.y]);\n        if (this.extraWalls != null){\n            var avoid_wall = this.extraWalls.map(part => [part.x, part.y]);\n            avoid = avoid.concat(avoid_wall);\n        }\n        this.apple.move(avoid);\n    }\n\n    update_score() {\n        this.score = this.snake.body.length() - this.snakeLength;\n        return this.score;\n    }\n\n    render() {\n        var context = this.canvas.context;\n        context.clearRect(0,0,this.width,this.height);\n        // snake\n        this.snake.body.forEach((part, i) => {\n            part.draw(context, this.snakeSprite);\n        });\n        // extra wall\n        if (this.extraWalls != null){\n            this.extraWalls.forEach((part, i) => {\n                part.draw(context, this.wallSprite);\n            });\n        }\n        // apple\n        this.apple.rect.draw(context, this.appleSprite);\n    }\n\n    manual_play() {\n        // store value of this\n        var self = this;\n        this.timer = setInterval(function(){\n            self.step();\n            self.key_pressed = 0;\n        }, 1000/this.FPS);\n    }\n\n    end_game() {\n        this.done = 1;\n        if (this.manual) {\n            clearInterval(this.timer);\n            console.log(\"You DIED!\");\n        } else {\n\n        }\n    }\n\n    step(action=null) {\n        if (this.done) return;\n\n        // training purpose: change direction\n        if (!(this.manual) && action != null) {\n            // action: integer in [0, 1, 2, 3]\n            this.snake.changeDirection(action);\n            this.last_snake = this.snake.head;\n            this.last_apple = this.apple.rect;\n        }\n\n        // move\n        this.snake.addHead(this.collideWall);\n\n        // wall collision\n        var tempTail;\n        if (this.snake.collideWithWall(this.extraWalls)) {\n            this.end_game();\n        } else {\n            tempTail = this.snake.deleteTail();\n        }\n        // body collision\n        if (this.snake.collideWithBody()) {\n            this.end_game();\n        }\n        // eat apple\n        if (this.snake.head.collideRect(this.apple.rect)) {\n            // add tail back\n            this.snake.addTail(tempTail);\n            // move apple\n            this.move_apple();\n            // update game values (score)\n            this.score += 1;\n            if (this.score > this.best_score) {\n                this.best_score = this.score;\n            }\n        } else {\n            // no longer needs to deleteTail() because we use another time logic\n            // this.snake.deleteTail();\n        }\n\n        // render\n        // this.render();\n\n        // conclude round\n        if (this.manual) {\n            return null;\n        } else {\n            return this.conclude_step();\n        }\n    }\n\n    conclude_step() {\n        // update eat-apple: 1 if apple moves\n        this.rewardMeasures[\"eat\"] = !(arrayEqual(\n            [this.last_apple.x, this.last_apple.y],\n            [this.apple.rect.x, this.apple.rect.y]\n        ));\n        // update closer or not\n        const last_distance = euclidean(\n            [this.last_snake.x, this.last_snake.y],\n            [this.last_apple.x, this.last_apple.y]\n        );\n        const distance = euclidean(\n            [this.snake.head.x, this.snake.head.y],\n            [this.apple.rect.x, this.apple.rect.y]\n        );\n        this.rewardMeasures[\"closer\"] = distance < last_distance;\n        this.rewardMeasures[\"away\"] = distance > last_distance;\n\n        // leave for future uss (if adding new rewards)\n\n        const next_state = this.update_state();\n        const reward = this.reward();\n        // clear reward measures\n        this.clear_reward();\n\n        return [next_state, reward, this.done, this.score];\n    }\n\n    keyboard_events() {\n        // key control of snake\n        document.body.addEventListener(\"keydown\", (event) => {\n            if (this.done) {\n                console.log(\"Game ended\");\n                return null;\n            }\n            if (this.key_pressed) {\n                console.log(\"key pressed in this round\");\n                return null;\n            } else {\n                this.key_pressed = 1;\n            }\n            const ARROW_ACTION = [\"ArrowUp\", \"ArrowRight\", \"ArrowDown\", \"ArrowLeft\"];\n            const key = ARROW_ACTION.indexOf(event.key);\n\n            this.snake.changeDirection(key);\n        });\n    }\n\n}\n","import * as tf from '@tensorflow/tfjs';\nimport * as util from \"./util\";\n\nclass Deque extends Array {\n    constructor(maxlen) {\n        super();\n        this.maxlen = maxlen;\n    }\n\n    pushDeque(item) {\n        if (this.length >= this.maxlen) this.shift();\n        this.push(item);\n    }\n}\n\nexport class Agent {\n    constructor(params) {\n        // mandatory\n        this.state_size = params[\"state_size\"];\n        this.action_size = params[\"action_size\"];\n        // default\n        this.gamma = 0.95;\n        this.epsilon = 1.0;\n        this.epsilon_decay = 0.995;\n        this.epsilon_min = 0.01;\n        this.learning_rate = 0.00025;\n\n        // load from params\n        for (var key in params) {\n            if (key == \"gamma\") this.gamma = params[key];\n            if (key == \"epsilon\") this.epsilon = params[key];\n            if (key == \"epsilon_decay\") this.epsilon_decay = params[key];\n            if (key == \"epsilon_min\") this.epsilon_min = params[key];\n            if (key == \"learning_rate\") this.learning_rate = params[key];\n        }\n\n        // initialize\n        this.model = this.build_model();\n\n        const maxlen = 2000;\n        this.memory = new Deque(maxlen);\n    }\n\n    /*\n    Note:\n    - the format of inputs is an (inputShape, N) matrix\n      N: number of batches/data\n    - for a 1D input, specify it as a tenser2d and its shape\n      e.g. var input = tf.tensor2d([1,2,3,4],[1,4])\n      shape [1,4]: 1 is the number of instances; 4 is the shape of input\n    */\n    build_model() {\n        const model = tf.sequential();\n        model.add(tf.layers.dense({\n            units: 128, inputShape: [this.state_size], activation: \"relu\"\n        }));\n        model.add(tf.layers.dense({\n            units: 128, activation: \"relu\"\n        }));\n        model.add(tf.layers.dense({\n            units: 128, activation: \"relu\"\n        }));\n        model.add(tf.layers.dense({\n            units: this.action_size, action: \"linear\"\n        }));\n        model.compile({\n            optimizer: tf.train.adam({learningRate: this.learning_rate}),\n            loss: 'meanSquaredError'\n        });\n        return model;\n    }\n\n    remember(state, action, reward, next_state, done){\n        this.memory.pushDeque([state, action, reward, next_state, done]);\n    }\n\n    async act(state) {\n        // state: tenser2d of size [1,state_size]\n        if (Math.random() <= this.epsilon) {\n            var action = util.getRandInt(0, this.action_size);\n        } else {\n            var action = await this.exploit(state);\n        }\n        return new Promise((resolve, reject) => {\n            resolve(action);\n        });\n    }\n\n    async exploit(state) {\n        const pred = await this.model.predict(state).reshape([this.action_size]);\n        const action = await pred.argMax().data();\n\n        return new Promise((resolve, reject) => {\n            // action is an array of size 1 -- [act]\n            resolve(action[0]);\n        });\n    }\n\n    async replay(batch_size=32) {\n        if (this.memory.length < batch_size) {\n            return Promise.resolve();\n        }\n\n        // sample mini-batch\n        const mini_batch = util.random_sample(this.memory, batch_size);\n\n        for (var i = 0; i < mini_batch.length; i++) {\n            // test purpose\n            if (i % 100 == 0) console.log(i);\n\n            var [state, action, reward, next_state, done] = mini_batch[i];\n            // compute target\n            var target = reward;\n            if (!(done)) {\n                const future_value = await this.model.predict(next_state).reshape([this.action_size]);\n                target = reward + this.gamma * future_value.max().dataSync()[0];\n            }\n            var target_state = await this.model.predict(state).reshape([this.action_size]);\n            await target_state.data().then(data => data[action] = target);\n            // train\n            await this.model.fit(state, target_state.reshape([1,this.action_size]), {\"epochs\": 1});\n        }\n        // decrease epsilon\n        if (this.epsilon > this.epsilon_min) {\n            this.epsilon *= this.epsilon_decay;\n        }\n        return new Promise((resolve, reject) => {\n            resolve();\n        });\n    }\n\n    async save_model(fname) {\n        await this.model.save(\"downloads://\" + fname);\n    }\n\n    async load_model(fname) {\n        this.model = await tf.loadLayersModel(\"localstorage://\" + fname);\n    }\n}\n","// import * as tf from '@tensorflow/tfjs-node';\n\n// global variable: array of performance\nvar performanceArray = [[\"episode\", \"score\", \"moves\", \"cumulative reward\"]];\n\nexport async function train(\n    env, agent, params = {\n    batch_size: 32, n_episodes: 50, max_moves: 500, last_episode: 0,\n    exp_replay: true\n    }) {\n    // load parameters\n    const batch_size = params[\"batch_size\"];\n    const n_episodes = params[\"n_episodes\"];\n    const max_moves = params[\"max_moves\"];\n    const last_episode = params[\"last_episode\"];\n    const exp_replay = params[\"exp_replay\"];\n\n    // main\n    var done = 0;\n    for (var e = 1; e <= n_episodes; e++) {\n        // start a new episode\n        var state = env.reset();\n        var cum_reward = 0;\n\n        for (var move = 1; move <= max_moves; move++) {\n            // step forward\n            const action = await agent.act(state);\n            var [next_state, reward, done, score] = env.step(action);\n            agent.remember(state, action, reward, next_state, done);\n            // update state \n            state = next_state;\n            cum_reward += reward;\n            // conclude round\n            if (exp_replay) {\n                await agent.replay(batch_size);\n            }\n            if (done) {\n                if (!(exp_replay)) await agent.replay(batch_size);\n                break;\n            }\n        }\n\n        // training process\n        const processLog = \"progress: {}/{}, score: {}, e: {}, moves: {}/{}\";\n        console.log(processLog.format(\n            e, n_episodes, score, agent.epsilon, move, max_moves\n        ));\n        // save performance\n        performanceArray.push([\n            e + last_episode, score, move, cum_reward\n        ]);\n        // console.log(performanceArray);\n        // save model\n        if (e >= 20 && e % 1 == 0) {\n            // uncomment to download trained models\n            // agent.save_model(\"model_{}\".format(e));\n        }\n    }\n    console.log(\"Training Ended.\")\n    return new Promise((resolve, reject) => {\n        resolve(performanceArray);\n    })\n}\n\n// export async function test_DQN(env, agent, params=None) {\n\n//     // fetch parameters\n//     n_tests = load_params(params, \"n_tests\", 10)\n//     max_moves = load_params(params, \"max_games\", 1000)\n//     FPS = load_params(params, \"FPS\", 10)\n//     verbose = load_params(params, \"verbose\", True)\n\n//     // start testing\n//     done = 0\n\n//     // Save data for performance analysis\n//     // each row is one instance: [reward, score, move]\n//     performance = np.zeros((n_tests, 3))\n\n//     for e in range(n_tests):\n\n//         // Step 1: Initialization\n//         state = env.reset()\n//         cum_reward = 0\n\n//         // Step 2: Simulate one trial of the game\n//         for move in range(max_moves):\n//             // action\n//             action = agent.exploit(state)\n//             // step forward\n//             next_state, reward, done, score = env.step(action)\n//             // conclude round\n//             state = next_state\n//             cum_reward += reward    // (this will always -100pt upon dead)\n//             if (done) {\n//                 break\n//             }\n\n//         // Step 3: Update performance\n//         performance[e,:] = [cum_reward, score, move]\n\n//     return performance\n// }\n\nexport default train;","import Sprite from \"./sprite\"\n\nexport const CANVAS_WIDTH = 20;\nexport const CANVAS_HEIGHT = 20;\nexport const GRID_SIZE = 20;\n\nexport const MANUAL_FPS = 3;\nexport const TEST_FPS = 10;\n\nexport const SNAKE_LENGTH = 1;\n\nexport const COLLIDE_WALL = true;\nexport const COLLIDE_BODY = true;\nexport const EXTRA_WALL = [\n    // [6,7], [7,7], [8,7], [7,6], [7,8],\n];\nfor (var row = 10; row <= 11; row++) {\n    for (var col = 6; col <= 15; col++) {\n        EXTRA_WALL.push([col, row]);\n    }\n}\n// export const WALL_PIX_POS = true; // assume to be always true\n\nexport const MANUAL = true;\n\nexport const STATE_TYPE = \"12bool\";\nexport const REWARD_TYPE = \"basic\";\n\nexport const snakeSprite = new Sprite(\"image/skin_1.png\");\nexport const appleSprite = new Sprite(\"image/star.png\");\nexport const wallSprite = new Sprite(\"image/tile.png\");\n","import {snakeGame} from \"./snakeGameClass\";\nimport {Agent} from \"./agentClass\";\nimport {train} from \"./train.js\";\nimport React from \"react\";\nimport Sketch from 'react-p5';\nimport \"p5\";\nimport {\n    CANVAS_WIDTH, CANVAS_HEIGHT, GRID_SIZE, \n    MANUAL_FPS, TEST_FPS, SNAKE_LENGTH,\n    COLLIDE_WALL, COLLIDE_BODY, EXTRA_WALL,\n    MANUAL,\n    STATE_TYPE, REWARD_TYPE\n} from \"./config\";\nimport * as util from \"./util\";\n\nfunction SnakeEnv(props) {\n    // resize parameters\n\n    // screen\n    var screen_width = props.dimension[0];\n    var screen_height = props.dimension[1];\n    var adaptive_grid_size = Math.min(\n        Math.floor(screen_width/CANVAS_WIDTH), Math.floor(screen_height/CANVAS_HEIGHT)\n    );\n    var screen_size = Math.min(screen_width, screen_height);\n    // score text\n    var text_size = Math.round(0.06*screen_size);\n    // restart button\n    var button_radius = Math.round(0.05*screen_width);\n    var button_x = Math.round(0.9*screen_size);\n    var button_y = Math.round(0.1*screen_size);\n\n    // variables\n\n    const env_params = {\n        width: CANVAS_WIDTH, height: CANVAS_HEIGHT, \n        gridSize: adaptive_grid_size, \n        FPS: MANUAL_FPS,\n        snakeLength: SNAKE_LENGTH, \n        extraWalls: EXTRA_WALL,\n        stateType: STATE_TYPE, rewardType: REWARD_TYPE,\n        manual: props.doManual\n    };\n\n    const agent_params  = {\n        state_size: 12, action_size: 4 \n    };\n\n    let game = new snakeGame(env_params);\n    let agent = new Agent(agent_params);\n\n    let img_restart;\n\n    const setup = (p5, canvasParentRef) => {\n        // use parent to render the canvas in this ref\n        // (without that p5 will render the canvas outside of your component)\n        var cnv = p5.createCanvas(screen_size, screen_size).parent(canvasParentRef);\n        cnv.position(\n            (screen_width - screen_size)/2, (screen_height - screen_size)/2\n        );\n\n        // train / test the model\n        if (props.doTrain) {\n            // alert(\"starting training\");\n            const train_params = {\n                batch_size: 512, n_episodes: 100,\n                max_moves: 1000, last_episode: 0,\n                exp_replay: true\n            };\n            train(game, agent, train_params);\n        }\n    };\n \n    const draw = (p5) => {\n        p5.background(220);\n        // p5.ellipse(50,50,80,80);\n\n        // plot snake and apple\n        p5.stroke(0, 0, 0);\n        game.snake.draw(p5);\n        game.apple.draw(p5);\n\n        // plot extra walls\n        p5.stroke(0, 0, 0);\n        p5.fill(\"#999999\");\n        for (var i=0; i < game.extraWalls.length; i++) {\n            var rect = game.extraWalls[i];\n            p5.rect(rect.x, rect.y, game.gridSize, game.gridSize);\n        }\n\n        // draw a restart button\n        p5.stroke(255,0,0);\n        p5.fill(255, 0, 0, 200);\n        p5.ellipse(button_x, button_y, button_radius, button_radius);\n\n        p5.mouseClicked = () => {\n            if (util.euclidean([p5.mouseX, p5.mouseY], [button_x, button_y]) <= 0.8*button_radius){\n                game.reset();\n            }\n        };\n\n        // draw score\n        p5.stroke(0,0,0,0);\n        p5.fill(\"#000000\");\n        p5.textSize(text_size);\n        p5.text(\"Score: \" + game.score, 0.5*text_size, text_size);\n        p5.text(\"Best Score: \" + game.best_score, 0.5*text_size, 2*text_size);\n\n    };\n\n    if (props.doTest) {\n        return null;\n    }\n\n    return (\n        <div id=\"snake_div\">\n            <Sketch setup={setup} draw={draw} />\n        </div>\n    );\n}\n\nexport default SnakeEnv;","import React, { useRef, useEffect, useState, useLayoutEffect } from 'react';\nimport css from './Reinforcement.module.css';\nimport {\n    BrowserRouter as Router,\n    Switch,\n    Route,\n    Link\n} from \"react-router-dom\";\n\nimport SnakeEnv from \"../games/snake/reinforcement_learning/SnakeEnv\";\n\nfunction Reinforcement(props) {\n\n    const gameParentRef = useRef(null);\n    const plotParentRef = useRef(null);\n    const [gameScreenDimension, setGameScreenDimension] = useState({width: 0, height: 0});\n    const [plotScreenDimension, setPlotScreenDimension] = useState({width: 0, height: 0});\n\n    useEffect ( () => {\n        if (gameParentRef.current) {\n            setGameScreenDimension({\n                width: gameParentRef.current.offsetWidth,\n                height: gameParentRef.current.offsetHeight\n            });\n        }\n        if (plotParentRef.current) {\n            setPlotScreenDimension({\n                width: plotParentRef.current.offsetWidth,\n                height: plotParentRef.current.offsetHeight\n            });\n        }\n    }, [gameParentRef, plotParentRef]);\n    return (\n        <Router basename={process.env.PUBLIC_URL}>\n            <div className={css.container}>\n                <h1 className={css.name} onClick={()=>{props.history.push(process.env.PUBLIC_URL+'/')}}>\n                    <Link to='/' className={css.text}>\n                        AlphaGame\n                    </Link>\n                </h1>\n                <div className={css.background}>\n                    <div className={css.gameScreen} ref={gameParentRef}>\n                        <Switch>\n                            <Route path='/snake'>\n                                {/* define env_params as a props.attribute if necessary */}\n                                {\n                                    gameScreenDimension.width === 0 ?\n                                    <div></div> : <SnakeEnv \n                                        doManual={false} \n                                        doTrain={true} \n                                        doTest={false} \n                                        dimension={[gameScreenDimension.width, gameScreenDimension.height]}\n                                    />\n                                }\n                            </Route>\n                            <Route path='/pong'>\n                                pong\n                            </Route>\n                            <Route path='/flappybird'>\n                                flappybird\n                            </Route>\n                        </Switch>\n                    </div>\n                    <div className={css.plotScreen} ref={plotParentRef}>\n                        <Switch>\n                            <Route path='/snake'>\n                                snake\n                            </Route>\n                            <Route path='/pong'>\n                                pong\n                            </Route>\n                            <Route path='/flappybird'>\n                                flappybird\n                            </Route>\n                        </Switch>\n                    </div>\n                </div>\n            </div>\n            <footer>\n                Copyright  2020 AlphaGame | \n                <a href='https://github.com/Alexduanran/AlphaGame' target='_blank' style={{textDecoration: 'none', color:'white'}}> Github</a>\n            </footer>\n        </Router>\n    );\n}\n\nexport default Reinforcement;\n","import css from './Battle.module.css';\nimport {\n    BrowserRouter as Router,\n    Switch,\n    Route,\n    Link\n} from \"react-router-dom\";\n\nfunction Battle(props) {\n  return (\n    <Router basename={process.env.PUBLIC_URL}>\n        <div className={css.container}>\n            <h1 className={css.name} onClick={()=>{props.history.push(process.env.PUBLIC_URL+'/')}}>\n                <Link to='/' className={css.text}>\n                    AlphaGame\n                </Link>\n            </h1>\n            <div className={css.background}>\n                <div className={css.gameScreen}>\n                    <Switch>\n                        <Route path='/snake'>\n                            snake\n                        </Route>\n                        <Route path='/pong'>\n                            pong\n                        </Route>\n                        <Route path='/flappybird'>\n                            flappybird\n                        </Route>\n                    </Switch>\n                </div>\n                <div className={css.plotScreen}>\n                    <Switch>\n                        <Route path='/snake'>\n                            {/* {\n                                gameScreenDimension.width === 0 ?\n                                <div></div> : \n                                <SnakeEnv dimension={[gameScreenDimension.width, gameScreenDimension.height]}/>\n                            } */}\n                        </Route>\n                        <Route path='/pong'>\n                            pong\n                        </Route>\n                        <Route path='/flappybird'>\n                            flappybird\n                        </Route>\n                    </Switch>\n                </div>\n            </div>\n        </div>\n        <footer>\n            Copyright  2020 AlphaGame | \n            <a href='https://github.com/Alexduanran/AlphaGame' target='_blank' style={{textDecoration: 'none', color:'white'}}> Github</a>\n        </footer>\n    </Router>\n  );\n}\n\nexport default Battle;\n","import css from './App.module.css';\nimport Home from './Home';\nimport Genetic from './Genetic';\nimport Reinforcement from './Reinforcement';\nimport Battle from './Battle';\nimport {\n  Router,\n  Switch,\n  Route,\n  Link\n} from \"react-router-dom\";\nimport { createBrowserHistory } from 'history';\nimport 'bootstrap/dist/css/bootstrap.min.css';\n\nconst history = createBrowserHistory();\n\nfunction App() {\n  return (\n    <div className={css.background}>\n      <Router history={history} basename={process.env.PUBLIC_URL}>\n        <Switch>\n          <Route path='/*/genetic'>\n            <Genetic history={history}/>\n          </Route>\n          <Route path='/*/reinforcement'>\n            <Reinforcement history={history}/>\n          </Route>\n          <Route path='*/battle'>\n            <Battle history={history}/>\n          </Route>\n          <Route path='/'>\n            <Home history={history}/>\n          </Route>\n        </Switch>\n      </Router>\n    </div>\n  );\n}\n\nexport default App;\n","const reportWebVitals = onPerfEntry => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import('web-vitals').then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport './index.css';\nimport App from './pages/App';\nimport reportWebVitals from './reportWebVitals';\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"background\":\"Home_background__3HbSX\",\"container\":\"Home_container__-DMjm\",\"grid\":\"Home_grid__33I0i\",\"mode\":\"Home_mode__2BOJe\",\"name\":\"Home_name__10Kwj\",\"smallpic\":\"Home_smallpic__3N7EV\",\"smallsquare\":\"Home_smallsquare__1oBA_\",\"screen\":\"Home_screen__3rdgN\",\"square\":\"Home_square__l604N\",\"swiper\":\"Home_swiper__33oto\",\"swiperContainer\":\"Home_swiperContainer__1LfR4\",\"text\":\"Home_text__3zRIA\"};"],"sourceRoot":""}